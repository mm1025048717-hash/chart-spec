# 中等文字45度倾斜设计规范

## 场景标识
- **场景编号**: 02
- **场景名称**: 中等文字45度倾斜
- **适用条件**: 视觉宽度 5-8 且 数据项 ≤ 12

---

## 1. 触发条件

### 判断逻辑
```javascript
function shouldUse45Degree(data, xField) {
    const maxWidth = Math.max(...data.map(d => getVisualWidth(String(d[xField]))));
    const count = data.length;
    
    // 不满足水平显示条件，但在中等范围内
    const notShort = maxWidth > 4 || count > 8;
    const inMediumRange = maxWidth <= 8 && count <= 12;
    
    return notShort && inMediumRange;
}
```

### 条件判断表
| 条件 | 阈值 | 说明 |
|-----|------|-----|
| 最大视觉宽度 | 5 - 8 | 超过4但不超过8 |
| 数据项数量 | ≤ 12 | 不超过12项 |
| 逻辑关系 | AND | 同时满足 |

### 适用数据示例
| 标签 | 视觉宽度 | 是否适用 |
|-----|---------|---------|
| 华东地区 | 8 | ✓ |
| January | 7 | ✓ |
| 2024Q1 | 6 | ✓ |
| Product A | 9 | ✗ (需截断) |

---

## 2. 旋转角度说明

### 弧度制转换
```
角度制: -45°
弧度制: -π/4 ≈ -0.7854

公式: 弧度 = 角度 × (π / 180)
     -45 × (π / 180) = -π/4
```

### 为什么用-45°
1. **可读性**: 45°是人眼最舒适的倾斜角度
2. **空间效率**: 比水平节省约30%横向空间
3. **美观性**: 视觉上整齐有序
4. **行业惯例**: 大多数图表库的默认倾斜角度

---

## 3. X轴配置参数

### 完整配置
```javascript
xAxis: {
    label: {
        autoRotate: false,
        rotate: -Math.PI / 4,  // -45度
        formatter: (text) => text,
        style: {
            fontSize: 11,
            fill: '#646A73',
            textAlign: 'end',  // 重要！
            textBaseline: 'middle',
        },
    },
    line: {
        style: {
            stroke: '#E5E6EB',
            lineWidth: 1,
        },
    },
}
```

### 关键参数说明
| 参数 | 值 | 重要性 | 说明 |
|-----|---|-------|-----|
| `rotate` | `-Math.PI/4` | ⭐⭐⭐ | 核心配置，-45度 |
| `textAlign` | `'end'` | ⭐⭐⭐ | 必须用end，否则错位 |
| `autoRotate` | `false` | ⭐⭐ | 禁用自动旋转 |
| `fontSize` | `11` | ⭐ | 标签字体大小 |

---

## 4. textAlign 深入解析

### 为什么旋转时必须用 'end'

```
水平文字 (textAlign: 'center'):
    ┌────────┐
    │ 华东地区 │  ← 文字中心对准刻度线
    └────┬───┘
         │
         ▼ (刻度线)

旋转文字 (textAlign: 'end'):
         ╲
          ╲华东地区  ← 文字末端对准刻度线
           ╲
            │
            ▼ (刻度线)

错误示例 (旋转 + textAlign: 'center'):
     ╲
      ╲华东地区  ← 文字中心对准刻度线，导致偏移
       ╲
            │
            ▼ (刻度线偏了)
```

### textAlign 选择规则
| rotate值 | textAlign | 原因 |
|---------|-----------|-----|
| 0 | center | 水平文字居中 |
| -π/4 到 -π/2 | end | 倾斜/垂直文字末端对齐 |
| π/4 到 π/2 | start | 反方向倾斜用start |

---

## 5. 柱体配置

```javascript
{
    color: '#5AD8A6',           // 绿色系
    columnWidthRatio: 0.5,
    columnStyle: {
        radius: [4, 4, 0, 0],
    },
}
```

---

## 6. 与场景1的过渡

### 判断优先级
```
数据输入
    ↓
计算 maxWidth 和 count
    ↓
┌─────────────────────────────────┐
│ maxWidth ≤ 4 && count ≤ 8 ?    │
│   YES → 场景1: 水平显示         │
│   NO  ↓                         │
└─────────────────────────────────┘
    ↓
┌─────────────────────────────────┐
│ maxWidth ≤ 8 && count ≤ 12 ?   │
│   YES → 场景2: 45°倾斜 ←当前    │
│   NO  ↓                         │
└─────────────────────────────────┘
    ↓
继续判断场景3/4/5/6
```

---

## 7. 边界情况

| 情况 | 视觉宽度 | 数据项 | 结果 |
|-----|---------|-------|-----|
| 刚好进入 | 5 | 8 | 45°倾斜 |
| 上边界 | 8 | 12 | 45°倾斜 |
| 宽度超限 | 9 | 10 | → 场景3 (截断) |
| 数量超限 | 6 | 15 | → 场景6 (90°) |
| 都超限 | 50 | 20 | → 场景4/6 |

---

## 8. 常见问题

### Q1: 为什么我的标签没有对准柱子中心？
**A**: 检查 textAlign 是否设置为 'end'。旋转时用 'center' 会导致偏移。

### Q2: 如何判断该用这个场景？
**A**: 
1. 先计算最大视觉宽度（中文×2，英文×1）
2. 检查是否在 5-8 范围内
3. 检查数据项是否 ≤ 12

### Q3: 45°角度可以调整吗？
**A**: 可以，但不建议。45°是最佳实践，其他角度可能影响可读性。

---

## 9. 文件结构

```
02-medium-text/
├── index.html    # 可视化展示页面
└── spec.md       # 本设计规范文档
```
