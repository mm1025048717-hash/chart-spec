<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>折线图 - 文字优化设计规范</title>
    <script src="https://cdn.jsdelivr.net/npm/@antv/g2plot@2.4.31/dist/g2plot.min.js"></script>
    <link rel="stylesheet" href="../common.css">
    <style>
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            max-width: 1200px;
            margin: 0 auto 32px;
        }
        @media (max-width: 900px) { .scenario-grid { grid-template-columns: 1fr; } }
        .chart-card.full-width { grid-column: span 2; }
        @media (max-width: 900px) { .chart-card.full-width { grid-column: span 1; } }
    </style>
</head>
<body>

<div class="page-header">
    <h1>折线图 - 文字优化设计规范</h1>
    <p class="subtitle">时间序列数据展示，X轴日期/标签智能处理 + 图例优化</p>
    <div class="tech-stack">
        <span class="tech-tag">Ant Design Charts</span>
        <span class="tech-tag">G2Plot Line</span>
        <span class="tech-tag">时间轴优化</span>
    </div>
</div>

<!-- 规范说明 -->
<div class="spec-section">
    <div class="spec-title">折线图文字优化要点</div>
    
    <table class="spec-table">
        <thead>
            <tr>
                <th>优化项</th>
                <th>问题场景</th>
                <th>解决方案</th>
                <th>代码配置</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><b>X轴日期标签</b></td>
                <td>日期过密重叠</td>
                <td>自动间隔显示</td>
                <td><code>tickInterval / tickCount</code></td>
            </tr>
            <tr>
                <td><b>X轴分类标签</b></td>
                <td>分类名过长</td>
                <td>旋转+截断</td>
                <td><code>rotate + formatter</code></td>
            </tr>
            <tr class="highlight">
                <td><b>图例文字</b></td>
                <td>系列名过长</td>
                <td>截断10字符</td>
                <td><code>legend.itemName.formatter</code></td>
            </tr>
            <tr>
                <td><b>数据点标签</b></td>
                <td>标签重叠</td>
                <td>仅显示关键点</td>
                <td><code>label.layout</code></td>
            </tr>
        </tbody>
    </table>
</div>

<!-- 图表场景 -->
<div class="scenario-grid">

    <!-- 基础折线图 -->
    <div class="chart-card">
        <div class="chart-card-header">
            <span class="chart-title">场景1: 时间序列 - 日期间隔显示</span>
            <span class="chart-tag blue">tickCount</span>
        </div>
        <div class="chart-body">
            <div id="chart-time" style="width: 100%; height: 100%;"></div>
            <div class="hover-hint">✨ 悬浮查看规范</div>
            
            <div class="annotation-layer">
                <div class="params-panel top-right">
                    <div class="params-panel-title">时间轴配置</div>
                    <div class="params-row">
                        <span class="label">tickCount</span>
                        <span class="value highlight">6</span>
                    </div>
                    <div class="params-row">
                        <span class="label">日期格式</span>
                        <span class="value">MM-DD</span>
                    </div>
                    <div class="params-divider"></div>
                    <div class="params-section">说明</div>
                    <div style="font-size: 10px; color: #999;">
                        自动选择合适的日期间隔<br>
                        避免标签过密重叠
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 多系列折线 -->
    <div class="chart-card">
        <div class="chart-card-header">
            <span class="chart-title">场景2: 多系列 - 图例截断</span>
            <span class="chart-tag green">legend truncate</span>
        </div>
        <div class="chart-body">
            <div id="chart-multi" style="width: 100%; height: 100%;"></div>
            <div class="hover-hint">✨ 悬浮查看规范</div>
            
            <div class="annotation-layer">
                <div class="area-highlight legend-area" style="top: 10px; right: 10px; width: 280px; height: 30px;"></div>
                
                <div class="params-panel top-right">
                    <div class="params-panel-title">多系列配置</div>
                    <div class="params-row">
                        <span class="label">seriesField</span>
                        <span class="value">'category'</span>
                    </div>
                    <div class="params-row">
                        <span class="label">图例截断</span>
                        <span class="value highlight">10字符</span>
                    </div>
                    <div class="params-divider"></div>
                    <div class="params-section">图例配置</div>
                    <div style="font-size: 10px; color: #E6E8EB; font-family: monospace;">
                        legend: {<br>
                        &nbsp;&nbsp;itemName: {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;formatter: truncate(10)<br>
                        &nbsp;&nbsp;}<br>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 长分类名 -->
    <div class="chart-card">
        <div class="chart-card-header">
            <span class="chart-title">场景3: 长分类名 - X轴旋转</span>
            <span class="chart-tag yellow">rotate: -45°</span>
        </div>
        <div class="chart-body">
            <div id="chart-long-label" style="width: 100%; height: 100%;"></div>
            <div class="hover-hint">✨ 悬浮查看规范</div>
            
            <div class="annotation-layer">
                <div class="area-highlight xaxis-area" style="bottom: 0; left: 50px; right: 10px; height: 60px;"></div>
                
                <div class="params-panel top-right">
                    <div class="params-panel-title">长分类名配置</div>
                    <div class="params-row">
                        <span class="label">rotate</span>
                        <span class="value highlight">-Math.PI/4</span>
                    </div>
                    <div class="params-row">
                        <span class="label">truncateAt</span>
                        <span class="value highlight">8</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 带数据点 -->
    <div class="chart-card">
        <div class="chart-card-header">
            <span class="chart-title">场景4: 数据点标签 - 智能布局</span>
            <span class="chart-tag purple">label layout</span>
        </div>
        <div class="chart-body">
            <div id="chart-with-label" style="width: 100%; height: 100%;"></div>
            <div class="hover-hint">✨ 悬浮查看规范</div>
            
            <div class="annotation-layer">
                <div class="params-panel top-right">
                    <div class="params-panel-title">数据标签配置</div>
                    <div class="params-row">
                        <span class="label">显示策略</span>
                        <span class="value">关键点</span>
                    </div>
                    <div class="params-row">
                        <span class="label">layout</span>
                        <span class="value highlight">hide-overlap</span>
                    </div>
                    <div class="params-divider"></div>
                    <div class="params-section">说明</div>
                    <div style="font-size: 10px; color: #999;">
                        自动隐藏重叠的标签<br>
                        只显示不重叠的关键数据点
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 完整场景 -->
    <div class="chart-card full-width">
        <div class="chart-card-header">
            <span class="chart-title">真实场景: 多产品线销售趋势</span>
            <span class="chart-tag blue">完整配置</span>
        </div>
        <div class="chart-meta">
            <div class="chart-meta-title">24年Q4各产品线日销售额趋势</div>
            <div class="chart-meta-info">
                <div class="chart-meta-item">
                    <span class="dot"></span>
                    <span>数据源: 销售流水表</span>
                </div>
            </div>
        </div>
        <div class="chart-body lg">
            <div class="axis-unit y-left">万元</div>
            <div id="chart-real" style="width: 100%; height: 100%;"></div>
            <div class="hover-hint">✨ 悬浮查看完整规范</div>
            
            <div class="annotation-layer">
                <div class="params-panel top-right">
                    <div class="params-panel-title">完整配置参数</div>
                    
                    <div class="params-section">折线配置</div>
                    <div class="params-row">
                        <span class="label">smooth</span>
                        <span class="value highlight">true</span>
                    </div>
                    <div class="params-row">
                        <span class="label">lineStyle.lineWidth</span>
                        <span class="value">2</span>
                    </div>
                    <div class="params-row">
                        <span class="label">point.size</span>
                        <span class="value">3</span>
                    </div>
                    
                    <div class="params-divider"></div>
                    <div class="params-section">X轴配置</div>
                    <div class="params-row">
                        <span class="label">tickCount</span>
                        <span class="value highlight">8</span>
                    </div>
                    <div class="params-row">
                        <span class="label">日期格式</span>
                        <span class="value">MM-DD</span>
                    </div>
                    
                    <div class="params-divider"></div>
                    <div class="params-section">图例配置</div>
                    <div class="params-row">
                        <span class="label">position</span>
                        <span class="value">top-right</span>
                    </div>
                    <div class="params-row">
                        <span class="label">截断</span>
                        <span class="value">10字符</span>
                    </div>
                </div>

                <div class="code-panel" style="bottom: 80px; left: 70px; min-width: 320px;">
                    <div class="code-panel-title">关键代码配置</div>
                    <div>
                        <span style="color: #F97583;">smooth</span>: <span style="color: #79B8FF;">true</span>,<br>
                        <span style="color: #F97583;">point</span>: { size: <span style="color: #79B8FF;">3</span>, shape: <span style="color: #9ECBFF;">'circle'</span> },<br>
                        <span style="color: #F97583;">xAxis</span>: {<br>
                        &nbsp;&nbsp;<span style="color: #FFAB70;">tickCount</span>: <span style="color: #79B8FF;">8</span>,<br>
                        &nbsp;&nbsp;<span style="color: #FFAB70;">label</span>: {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;<span style="color: #B392F0;">formatter</span>: (v) => v.slice(<span style="color: #79B8FF;">5</span>)<br>
                        &nbsp;&nbsp;}<br>
                        }
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- 代码示例 -->
<div class="spec-section">
    <div class="spec-title">完整代码实现</div>
    <div class="code-block">
<span class="comment">// 折线图配置</span>
<span class="keyword">new</span> Line(<span class="string">'container'</span>, {
    data,
    xField: <span class="string">'date'</span>,
    yField: <span class="string">'value'</span>,
    seriesField: <span class="string">'category'</span>,    <span class="comment">// 多系列</span>
    
    <span class="comment">// 折线样式</span>
    smooth: <span class="keyword">true</span>,                  <span class="comment">// 平滑曲线</span>
    lineStyle: { lineWidth: <span class="number">2</span> },
    
    <span class="comment">// 数据点</span>
    point: {
        size: <span class="number">3</span>,
        shape: <span class="string">'circle'</span>,
        style: { stroke: <span class="string">'#fff'</span>, lineWidth: <span class="number">1</span> }
    },
    
    <span class="comment">// X轴 - 时间轴配置</span>
    xAxis: {
        tickCount: <span class="number">8</span>,              <span class="comment">// 控制刻度数量</span>
        label: {
            formatter: (v) => {
                <span class="comment">// 日期格式化：2024-01-15 → 01-15</span>
                <span class="keyword">return</span> v.substring(<span class="number">5</span>);
            },
            style: { fontSize: <span class="number">11</span> }
        }
    },
    
    <span class="comment">// 图例 - 带截断</span>
    legend: {
        position: <span class="string">'top-right'</span>,
        itemName: {
            formatter: (text) => text.length > <span class="number">10</span> 
                ? text.substring(<span class="number">0</span>, <span class="number">10</span>) + <span class="string">'...'</span> 
                : text
        }
    },
    
    <span class="comment">// 颜色</span>
    color: [<span class="string">'#5B8FF9'</span>, <span class="string">'#5AD8A6'</span>, <span class="string">'#F6BD16'</span>, <span class="string">'#E86452'</span>],
    
    <span class="comment">// Tooltip</span>
    tooltip: {
        showCrosshairs: <span class="keyword">true</span>,
        crosshairs: { type: <span class="string">'x'</span> }
    }
}).render();
    </div>
</div>

<script>
    const { Line } = G2Plot;

    // 生成时间序列数据
    function generateTimeData(days, startValue, variance) {
        const data = [];
        const start = new Date('2024-10-01');
        let value = startValue;
        for (let i = 0; i < days; i++) {
            const date = new Date(start);
            date.setDate(start.getDate() + i);
            value = value + (Math.random() - 0.5) * variance;
            data.push({
                date: date.toISOString().split('T')[0],
                value: Math.round(value)
            });
        }
        return data;
    }

    // 场景1: 时间序列
    const timeData = generateTimeData(30, 1000, 200);

    new Line('chart-time', {
        data: timeData,
        xField: 'date',
        yField: 'value',
        smooth: true,
        color: '#5B8FF9',
        lineStyle: { lineWidth: 2 },
        point: { size: 2, shape: 'circle' },
        xAxis: {
            tickCount: 6,
            label: {
                formatter: (v) => v.substring(5),
                style: { fontSize: 11 }
            }
        },
        yAxis: { title: { text: '万元', style: { fontSize: 11 } } },
    }).render();

    // 场景2: 多系列
    const multiData = [];
    const categories = ['iPhone 15 Pro Max销量', 'MacBook Pro 16英寸销量', 'iPad Pro 12.9销量'];
    categories.forEach((cat, idx) => {
        const baseData = generateTimeData(20, 500 + idx * 200, 100);
        baseData.forEach(d => {
            multiData.push({ ...d, category: cat });
        });
    });

    new Line('chart-multi', {
        data: multiData,
        xField: 'date',
        yField: 'value',
        seriesField: 'category',
        smooth: true,
        lineStyle: { lineWidth: 2 },
        color: ['#5B8FF9', '#5AD8A6', '#F6BD16'],
        legend: {
            position: 'top-right',
            itemName: {
                formatter: (text) => text.length > 10 ? text.substring(0, 10) + '...' : text
            }
        },
        xAxis: {
            tickCount: 5,
            label: { formatter: (v) => v.substring(5), style: { fontSize: 11 } }
        },
        tooltip: {
            formatter: (datum) => ({ name: datum.category, value: datum.value + ' 万元' })
        }
    }).render();

    // 场景3: 长分类名
    const longLabelData = [
        { category: '华东大区销售部', value: 3650 },
        { category: '华北大区销售部', value: 2808 },
        { category: '华南大区销售部', value: 2408 },
        { category: '华中大区销售部', value: 2236 },
        { category: '西北大区销售部', value: 1500 },
        { category: '西南大区销售部', value: 1800 },
    ];

    new Line('chart-long-label', {
        data: longLabelData,
        xField: 'category',
        yField: 'value',
        smooth: true,
        color: '#F6BD16',
        lineStyle: { lineWidth: 2 },
        point: { size: 4, shape: 'circle' },
        xAxis: {
            label: {
                autoRotate: false,
                rotate: -Math.PI / 4,
                formatter: (text) => text.length > 8 ? text.substring(0, 8) + '...' : text,
                style: { fontSize: 11, textAlign: 'end' }
            }
        },
        yAxis: { title: { text: '万元', style: { fontSize: 11 } } },
    }).render();

    // 场景4: 带数据标签
    const labelData = generateTimeData(15, 800, 150);

    new Line('chart-with-label', {
        data: labelData,
        xField: 'date',
        yField: 'value',
        smooth: true,
        color: '#9270CA',
        lineStyle: { lineWidth: 2 },
        point: { size: 4, shape: 'circle' },
        label: {
            layout: [{ type: 'hide-overlap' }],
            style: { fontSize: 10, fill: '#9270CA' }
        },
        xAxis: {
            tickCount: 5,
            label: { formatter: (v) => v.substring(5), style: { fontSize: 11 } }
        },
        yAxis: { title: { text: '万元', style: { fontSize: 11 } } },
    }).render();

    // 真实场景
    const realData = [];
    const products = ['iPhone系列', 'Mac系列', 'iPad系列', '配件周边'];
    const colors = ['#5B8FF9', '#5AD8A6', '#F6BD16', '#E86452'];
    products.forEach((prod, idx) => {
        const baseData = generateTimeData(30, 300 + idx * 150, 80);
        baseData.forEach(d => {
            realData.push({ ...d, product: prod });
        });
    });

    new Line('chart-real', {
        data: realData,
        xField: 'date',
        yField: 'value',
        seriesField: 'product',
        smooth: true,
        lineStyle: { lineWidth: 2 },
        point: { size: 3, shape: 'circle' },
        color: colors,
        legend: {
            position: 'top-right',
            itemName: {
                formatter: (text) => text.length > 10 ? text.substring(0, 10) + '...' : text
            }
        },
        xAxis: {
            tickCount: 8,
            label: {
                formatter: (v) => v.substring(5),
                style: { fontSize: 11 }
            }
        },
        yAxis: {
            title: { text: '销售额', style: { fontSize: 12 } },
            label: { formatter: (v) => v }
        },
        tooltip: {
            showCrosshairs: true,
            crosshairs: { type: 'x' },
            formatter: (datum) => ({ name: datum.product, value: datum.value + ' 万元' })
        }
    }).render();
</script>


<script src="../nav.js"></script>
</body>
</html>
