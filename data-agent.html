<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <title>DataAgent - æ™ºèƒ½å›¾è¡¨åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/@antv/g2plot@2.4.31/dist/g2plot.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        :root {
            --blue: #5B8FF9;
            --green: #5AD8A6;
            --yellow: #F6BD16;
            --red: #E86452;
            --cyan: #6DC8EC;
            --purple: #945FB9;
            --bg: #F7F8FA;
            --card: #FFFFFF;
            --text-1: #1F2329;
            --text-2: #646A73;
            --text-3: #8F959E;
            --border: #E5E6EB;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "PingFang SC", sans-serif;
            background: var(--bg);
            color: var(--text-1);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* æç®€å¤´éƒ¨ */
        .header {
            padding: calc(8px + var(--safe-top)) 16px 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--card);
            border-bottom: 0.5px solid var(--border);
            flex-shrink: 0;
        }
        .header-back { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: none; border: none; color: var(--text-1); }
        .header-title { font-size: 16px; font-weight: 600; }
        .header-action { width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: none; border: none; color: var(--text-2); }

        /* èŠå¤©åŒº */
        .chat-area { flex: 1; overflow-y: auto; }
        .welcome {
            height: 100%;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            padding: 40px 24px;
        }
        .welcome-icon { font-size: 56px; margin-bottom: 16px; }
        .welcome-title { font-size: 20px; font-weight: 600; margin-bottom: 6px; }
        .welcome-desc { font-size: 13px; color: var(--text-2); text-align: center; }

        .messages { padding: 12px 16px; display: none; }
        .messages.active { display: block; }

        /* ç”¨æˆ·æ¶ˆæ¯ - æç®€æ°”æ³¡ */
        .msg-user {
            display: flex; justify-content: flex-end;
            margin-bottom: 12px;
        }
        .msg-user-content {
            background: var(--blue);
            color: #fff;
            padding: 10px 14px;
            border-radius: 16px 16px 4px 16px;
            font-size: 14px;
            max-width: 75%;
        }

        /* Agentæ¶ˆæ¯ */
        .msg-agent { margin-bottom: 16px; }

        /* ===== ç®€çº¦å›¾è¡¨å¡ç‰‡ ===== */
        .chart-card {
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        .chart-header {
            padding: 14px 16px 12px;
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }
        .chart-title-area { flex: 1; }
        .chart-title { font-size: 15px; font-weight: 600; color: var(--text-1); }
        .chart-subtitle { font-size: 11px; color: var(--text-3); margin-top: 2px; }
        .chart-badge {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
        }
        .chart-badge:hover { opacity: 0.8; }
        .chart-badge:active { transform: scale(0.95); }
        .chart-badge.blue { background: rgba(91,143,249,0.1); color: var(--blue); }
        .chart-badge.green { background: rgba(90,216,166,0.1); color: var(--green); }
        .chart-badge.yellow { background: rgba(246,189,22,0.1); color: #D69E00; }
        .chart-badge.red { background: rgba(232,100,82,0.1); color: var(--red); }
        .chart-badge.purple { background: rgba(148,95,185,0.1); color: var(--purple); }
        .chart-badge.gray { background: rgba(143,149,158,0.1); color: var(--text-2); }

        .chart-body {
            padding: 0 16px 16px;
            position: relative;
        }
        .chart-box { width: 100%; height: 220px; }

        /* ç®€åŒ–çš„æ±‡æ€»è¡Œ */
        .chart-footer {
            padding: 12px 16px;
            background: var(--bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
        }
        .footer-stat { color: var(--text-2); }
        .footer-stat strong { color: var(--blue); font-weight: 600; }
        .footer-trend { display: flex; align-items: center; gap: 4px; font-weight: 500; }
        .footer-trend.up { color: var(--green); }
        .footer-trend.down { color: var(--red); }

        /* ç®€çº¦æ´å¯Ÿ */
        .insight-line {
            padding: 10px 16px;
            font-size: 12px;
            color: var(--text-2);
            border-top: 0.5px solid var(--border);
            line-height: 1.5;
        }
        .insight-line strong { color: var(--blue); }

        /* æ•°æ®å¡ç‰‡ - ç´§å‡‘ç‰ˆ */
        .data-card {
            background: var(--card);
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04);
        }
        .data-card-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-1);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .data-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .data-item {
            background: var(--bg);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        .data-label { font-size: 10px; color: var(--text-3); }
        .data-value { font-size: 18px; font-weight: 700; color: var(--blue); margin-top: 2px; }
        .data-trend { font-size: 10px; color: var(--green); margin-top: 2px; }

        /* å æ¯”å¡ç‰‡ */
        .ratio-card {
            background: var(--card);
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 12px;
        }
        .ratio-title { font-size: 13px; font-weight: 600; margin-bottom: 10px; }
        .ratio-bar {
            height: 8px;
            background: var(--bg);
            border-radius: 4px;
            overflow: hidden;
            display: flex;
        }
        .ratio-segment { height: 100%; }
        .ratio-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 10px;
            font-size: 11px;
        }
        .ratio-legend-item { display: flex; align-items: center; gap: 4px; color: var(--text-2); }
        .ratio-dot { width: 8px; height: 8px; border-radius: 2px; }

        /* æ’ååˆ—è¡¨ */
        .rank-list { padding: 0; }
        .rank-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 0.5px solid var(--border);
        }
        .rank-item:last-child { border-bottom: none; }
        .rank-num {
            width: 20px; height: 20px;
            border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 11px; font-weight: 600;
            margin-right: 10px;
        }
        .rank-num.top { background: var(--blue); color: #fff; }
        .rank-num.normal { background: var(--bg); color: var(--text-2); }
        .rank-name { flex: 1; font-size: 13px; color: var(--text-1); }
        .rank-value { font-size: 13px; font-weight: 600; color: var(--text-1); }
        .rank-bar-wrap { width: 80px; margin-left: 10px; }
        .rank-bar { height: 4px; background: var(--blue); border-radius: 2px; }

        /* æ¼æ–—æ•°æ® - å±…ä¸­æ¼æ–—å½¢çŠ¶ */
        .funnel-list { padding: 0 10px; }
        .funnel-item {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
        }
        .funnel-label { width: 40px; font-size: 11px; color: var(--text-2); text-align: right; padding-right: 8px; }
        .funnel-bar-wrap { flex: 1; height: 28px; display: flex; align-items: center; justify-content: center; }
        .funnel-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--blue), var(--cyan));
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            color: #fff;
            font-weight: 500;
            min-width: 40px;
        }
        .funnel-rate { width: 45px; text-align: left; font-size: 11px; color: var(--text-3); padding-left: 8px; }

        /* è¾“å…¥ */
        .typing { padding: 12px 0; }
        .typing-dots { display: flex; gap: 4px; }
        .typing-dot {
            width: 6px; height: 6px;
            background: var(--text-3);
            border-radius: 50%;
            animation: bounce 1.4s infinite ease-in-out;
        }
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%,80%,100%{transform:translateY(0)} 40%{transform:translateY(-4px)} }

        /* å¿«æ·æ“ä½œ */
        .quick-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .quick-btn {
            padding: 6px 12px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 16px;
            font-size: 12px;
            color: var(--text-1);
            cursor: pointer;
        }
        .quick-btn:active { background: var(--bg); }

        /* åº•éƒ¨ */
        .bottom-area {
            flex-shrink: 0;
            background: var(--card);
            border-top: 0.5px solid var(--border);
            padding-bottom: var(--safe-bottom);
        }
        .prompts-scroll {
            padding: 10px 0;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .prompts-scroll::-webkit-scrollbar { display: none; }
        .prompts-container {
            display: flex;
            gap: 8px;
            padding: 0 16px;
            width: max-content;
        }
        .prompt-chip {
            flex-shrink: 0;
            padding: 6px 12px;
            background: var(--bg);
            border-radius: 16px;
            font-size: 12px;
            color: var(--text-1);
            cursor: pointer;
            white-space: nowrap;
        }
        .prompt-chip:active { background: rgba(91,143,249,0.1); color: var(--blue); }

        .input-area {
            padding: 8px 16px 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .input-box {
            flex: 1;
            display: flex;
            align-items: center;
            background: var(--bg);
            border-radius: 20px;
            padding: 0 14px;
            height: 40px;
        }
        .input-box input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 14px;
            outline: none;
            color: var(--text-1);
        }
        .input-box input::placeholder { color: var(--text-3); }
        .send-btn {
            width: 40px; height: 40px;
            background: var(--blue);
            border: none; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: #fff; cursor: pointer;
        }

        /* åº•éƒ¨å¯¼èˆª */
        .tabbar {
            display: flex;
            padding: 6px 0;
            border-top: 0.5px solid var(--border);
        }
        .tab-item {
            flex: 1;
            display: flex; flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--text-3);
            font-size: 10px;
            gap: 2px;
        }
        .tab-item.active { color: var(--blue); }
        .tab-icon { width: 20px; height: 20px; }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<header class="header">
    <button class="header-back" onclick="history.back()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
    </button>
    <span class="header-title">æ•°æ®åˆ†æ</span>
    <button class="header-action">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
    </button>
</header>

<div class="chat-area" id="chatArea">
    <div class="welcome" id="welcome">
        <div class="welcome-icon">ğŸ“Š</div>
        <div class="welcome-title">DataAgent</div>
        <div class="welcome-desc">é—®æˆ‘ä»»ä½•æ•°æ®é—®é¢˜ï¼Œæˆ‘ä¼šé€‰æ‹©æœ€åˆé€‚çš„å›¾è¡¨æ¥å›ç­”</div>
    </div>
    <div class="messages" id="messages"></div>
</div>

<div class="bottom-area">
    <div class="prompts-scroll">
        <div class="prompts-container" id="prompts"></div>
    </div>
    <div class="input-area">
        <div class="input-box">
            <input type="text" id="userInput" placeholder="è¾“å…¥åˆ†æé—®é¢˜..." onkeypress="if(event.key==='Enter')send()">
        </div>
        <button class="send-btn" onclick="send()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
    </div>
    <nav class="tabbar">
        <a href="mobile.html" class="tab-item"><svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/></svg><span>é¦–é¡µ</span></a>
        <a href="mobile-spec.html" class="tab-item"><svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg><span>è§„èŒƒ</span></a>
        <a href="data-agent.html" class="tab-item active"><svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/></svg><span>æ–¹æ¡ˆ</span></a>
        <a href="index.html" class="tab-item"><svg class="tab-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/></svg><span>æ¡Œé¢</span></a>
    </nav>
</div>

<script>
const COLORS = ['#5B8FF9', '#5AD8A6', '#5D7092', '#F6BD16', '#E86452', '#6DC8EC', '#945FB9', '#FF9845'];
let msgId = 0;

// é—®é¢˜åœºæ™¯åˆ—è¡¨ - 26ç§å›¾è¡¨å…¨è¦†ç›–
const promptList = [
    // 1. æŸ±çŠ¶å›¾ - å¯¹æ¯”ç±»
    { text: 'å„åŒºåŸŸé”€å”®é¢å¯¹æ¯”', type: 'column', question: 'å„åŒºåŸŸé”€å”®é¢å¯¹æ¯”å¦‚ä½•ï¼Ÿ' },
    
    // 2. å †å æŸ±çŠ¶å›¾ - æ„æˆå¯¹æ¯”
    { text: 'å„åŒºåŸŸäº§å“æ„æˆ', type: 'stackedColumn', question: 'å„åŒºåŸŸäº§å“é”€å”®æ„æˆå¦‚ä½•ï¼Ÿ' },
    
    // 3. æ¡å½¢å›¾ - æ’å
    { text: 'é”€é‡æ’è¡ŒTOP5', type: 'bar', question: 'å“ªäº›äº§å“é”€é‡æœ€é«˜ï¼Ÿ' },
    
    // 4. æŠ˜çº¿å›¾ - è¶‹åŠ¿
    { text: 'é”€å”®é¢æœˆåº¦è¶‹åŠ¿', type: 'line', question: 'é”€å”®é¢è¶‹åŠ¿å¦‚ä½•å˜åŒ–ï¼Ÿ' },
    
    // 5. é¢ç§¯å›¾ - ç´¯ç§¯è¶‹åŠ¿
    { text: 'ç”¨æˆ·å¢é•¿èµ°åŠ¿', type: 'area', question: 'ç”¨æˆ·å¢é•¿è¶‹åŠ¿å¦‚ä½•ï¼Ÿ' },
    
    // 6. é¥¼å›¾ - å æ¯”
    { text: 'å„æ¸ é“é”€å”®å æ¯”', type: 'pie', question: 'å„æ¸ é“å æ¯”å¤šå°‘ï¼Ÿ' },
    
    // 7. ç›´æ–¹å›¾ - åˆ†å¸ƒ
    { text: 'è®¢å•é‡‘é¢åˆ†å¸ƒ', type: 'histogram', question: 'è®¢å•é‡‘é¢åˆ†å¸ƒæƒ…å†µï¼Ÿ' },
    
    // 8. æ•£ç‚¹å›¾ - ç›¸å…³æ€§
    { text: 'é”€å”®åˆ©æ¶¦ç›¸å…³æ€§', type: 'scatter', question: 'é”€å”®å’Œåˆ©æ¶¦æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ' },
    
    // 9. æ°”æ³¡å›¾ - ä¸‰ç»´å…³ç³»
    { text: 'äº§å“é”€é‡åˆ©æ¶¦è§„æ¨¡', type: 'bubble', question: 'å„äº§å“é”€é‡ã€åˆ©æ¶¦å’Œè§„æ¨¡ï¼Ÿ' },
    
    // 10. é›·è¾¾å›¾ - å¤šç»´è¯„ä¼°
    { text: 'äº§å“èƒ½åŠ›è¯„ä¼°', type: 'radar', question: 'äº§å“å„ç»´åº¦è¡¨ç°å¦‚ä½•ï¼Ÿ' },
    
    // 11. æ¼æ–—å›¾ - è½¬åŒ–
    { text: 'ç”¨æˆ·è½¬åŒ–æ¼æ–—', type: 'funnel', question: 'ç”¨æˆ·è½¬åŒ–ç‡æ€ä¹ˆæ ·ï¼Ÿ' },
    
    // 12. ä»ªè¡¨ç›˜ - KPI
    { text: 'KPIè¾¾æˆæƒ…å†µ', type: 'gauge', question: 'KPIå®Œæˆå¾—æ€ä¹ˆæ ·ï¼Ÿ' },
    
    // 13. å¸•ç´¯æ‰˜å›¾ - äºŒå…«åˆ†æ
    { text: 'é—®é¢˜ç±»å‹å¸•ç´¯æ‰˜', type: 'pareto', question: 'å“ªäº›é—®é¢˜æœ€å…³é”®ï¼Ÿ' },
    
    // 14. çŸ©å½¢æ ‘å›¾ - å±‚çº§æ„æˆ
    { text: 'å“ç±»ç»“æ„åˆ†æ', type: 'treemap', question: 'å„å“ç±»å æ¯”ç»“æ„å¦‚ä½•ï¼Ÿ' },
    
    // 15. è¯äº‘ - æ–‡æœ¬
    { text: 'çƒ­é—¨å…³é”®è¯åˆ†æ', type: 'wordcloud', question: 'ç”¨æˆ·æœç´¢çƒ­è¯æœ‰å“ªäº›ï¼Ÿ' },
    
    // 16. çƒ­åŠ›å›¾ - æ—¶é—´åˆ†å¸ƒ
    { text: 'è®¿é—®çƒ­åŠ›åˆ†æ', type: 'heatmap', question: 'ä»€ä¹ˆæ—¶å€™è®¿é—®é‡æœ€é«˜ï¼Ÿ' },
    
    // 17. åœ°å›¾ - åœ°ç†åˆ†å¸ƒ
    { text: 'å„çœé”€å”®åˆ†å¸ƒ', type: 'map', question: 'å„çœé”€å”®æƒ…å†µå¦‚ä½•ï¼Ÿ' },
    
    // 18. è¡¨æ ¼ - æ˜ç»†æ•°æ®
    { text: 'é”€å”®æ˜ç»†æ•°æ®', type: 'table', question: 'é”€å”®æ˜ç»†æ•°æ®æ˜¯ä»€ä¹ˆï¼Ÿ' },
    
    // 19. æŒ‡æ ‡å¡ - æ ¸å¿ƒæŒ‡æ ‡
    { text: 'å…³é”®ä¸šåŠ¡æŒ‡æ ‡', type: 'indicator', question: 'å…³é”®ä¸šåŠ¡æŒ‡æ ‡æ˜¯å¤šå°‘ï¼Ÿ' },
    
    // 20. ç¯å›¾ - è¿›åº¦/å æ¯”
    { text: 'ç›®æ ‡å®Œæˆè¿›åº¦', type: 'ring', question: 'ç›®æ ‡å®Œæˆäº†å¤šå°‘ï¼Ÿ' },
    
    // 21. ç€‘å¸ƒå›¾ - å¢å‡åˆ†æ
    { text: 'åˆ©æ¶¦æ„æˆåˆ†æ', type: 'waterfall', question: 'åˆ©æ¶¦æ˜¯æ€ä¹ˆæ„æˆçš„ï¼Ÿ' },
    
    // 22. åŒè½´å›¾ - å¤åˆåˆ†æ
    { text: 'é”€é‡ä¸å¢é•¿ç‡å¯¹æ¯”', type: 'dualAxes', question: 'é”€é‡å’Œå¢é•¿ç‡å…³ç³»ï¼Ÿ' },
    
    // 23. ç«ç‘°å›¾ - æåæ ‡å æ¯”
    { text: 'å®¢æˆ·æ¥æºåˆ†å¸ƒ', type: 'rose', question: 'å®¢æˆ·éƒ½ä»å“ªæ¥ï¼Ÿ' },
    
    // 24. æ—­æ—¥å›¾ - å±‚çº§å æ¯”
    { text: 'ç»„ç»‡æ¶æ„åˆ†å¸ƒ', type: 'sunburst', question: 'ç»„ç»‡æ¶æ„åˆ†å¸ƒæƒ…å†µï¼Ÿ' },
    
    // 25. æ¡‘åŸºå›¾ - æµå‘
    { text: 'ç”¨æˆ·æµå‘åˆ†æ', type: 'sankey', question: 'ç”¨æˆ·ä»å“ªæ¥åˆ°å“ªå»ï¼Ÿ' },
    
    // 26. è¿›åº¦æ¡ - å¤šä»»åŠ¡è¿›åº¦
    { text: 'é¡¹ç›®è¿›åº¦è¿½è¸ª', type: 'progress', question: 'é¡¹ç›®è¿›åº¦å¦‚ä½•ï¼Ÿ' }
];

function initPrompts() {
    document.getElementById('prompts').innerHTML = promptList.map(p => 
        `<div class="prompt-chip" onclick="ask('${p.question}','${p.type}')">${p.text}</div>`
    ).join('');
}

function send() {
    const input = document.getElementById('userInput');
    const text = input.value.trim();
    if (!text) return;
    
    let type = 'column';
    // 26ç§å›¾è¡¨å…³é”®è¯æ˜ å°„
    const map = {
        // åŸºç¡€å›¾è¡¨
        'æŸ±çŠ¶': 'column', 'å †å ': 'stackedColumn', 'æ¡å½¢': 'bar', 'æŠ˜çº¿': 'line', 
        'è¶‹åŠ¿': 'line', 'é¢ç§¯': 'area', 'é¥¼': 'pie', 'ç¯': 'ring',
        // ç»Ÿè®¡å›¾è¡¨
        'ç›´æ–¹': 'histogram', 'æ•£ç‚¹': 'scatter', 'æ°”æ³¡': 'bubble', 'é›·è¾¾': 'radar',
        // ç‰¹æ®Šå›¾è¡¨
        'æ¼æ–—': 'funnel', 'è½¬åŒ–': 'funnel', 'ä»ªè¡¨': 'gauge', 'å¸•ç´¯æ‰˜': 'pareto', 'äºŒå…«': 'pareto',
        // å±‚çº§/æ„æˆ
        'æ ‘å›¾': 'treemap', 'è¯äº‘': 'wordcloud', 'çƒ­åŠ›': 'heatmap', 'æ—­æ—¥': 'sunburst',
        // åœ°ç†/è¡¨æ ¼
        'åœ°å›¾': 'map', 'çœä»½': 'map', 'è¡¨æ ¼': 'table', 'æ˜ç»†': 'table', 
        // æŒ‡æ ‡/è¿›åº¦
        'æŒ‡æ ‡': 'indicator', 'KPI': 'indicator', 'è¿›åº¦': 'progress',
        // æµç¨‹/å¤åˆ
        'ç€‘å¸ƒ': 'waterfall', 'åŒè½´': 'dualAxes', 'ç«ç‘°': 'rose', 'æ¡‘åŸº': 'sankey', 'æµå‘': 'sankey',
        // é€šç”¨å…³é”®è¯
        'é”€å”®': 'column', 'æ’å': 'bar', 'å æ¯”': 'pie', 'æ„æˆ': 'stackedColumn',
        'åˆ†å¸ƒ': 'histogram', 'ç›¸å…³': 'scatter', 'å…³é”®è¯': 'wordcloud', 'çƒ­é—¨': 'wordcloud'
    };
    for (const [k, v] of Object.entries(map)) { if (text.includes(k)) { type = v; break; } }
    
    ask(text, type);
    input.value = '';
}

function ask(text, type) {
    showMessages();
    addUserMsg(text);
    showTyping();
    
    setTimeout(() => {
        hideTyping();
        renderResponse(type);
        scrollToBottom();
    }, 800);
}

function showMessages() {
    document.getElementById('welcome').classList.add('hidden');
    document.getElementById('messages').classList.add('active');
}

function addUserMsg(text) {
    const el = document.createElement('div');
    el.className = 'msg-user';
    el.innerHTML = `<div class="msg-user-content">${text}</div>`;
    document.getElementById('messages').appendChild(el);
}

function showTyping() {
    const el = document.createElement('div');
    el.className = 'msg-agent';
    el.id = 'typing';
    el.innerHTML = `<div class="typing"><div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div></div>`;
    document.getElementById('messages').appendChild(el);
    scrollToBottom();
}

function hideTyping() {
    const el = document.getElementById('typing');
    if (el) el.remove();
}

// æ ¹æ®å›¾è¡¨ç±»å‹æ¸²æŸ“ä¸åŒæ ·å¼çš„å“åº”
function renderResponse(type) {
    const container = document.getElementById('messages');
    const div = document.createElement('div');
    div.className = 'msg-agent';
    
    const configs = getChartConfig(type);
    div.innerHTML = configs.html;
    container.appendChild(div);
    
    // æ¸²æŸ“å›¾è¡¨
    if (configs.chartId) {
        setTimeout(() => renderChart(configs.chartId, type), 100);
    }
}

function getChartConfig(type) {
    const chartId = `chart-${++msgId}`;
    
    switch(type) {
        case 'column':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-area">
                                <div class="chart-title">é”€å”®é¢å¯¹æ¯”</div>
                                <div class="chart-subtitle">2024å¹´12æœˆ Â· æŒ‰åœ°åŒº</div>
                            </div>
                            <a href="01-column/index.html" class="chart-badge blue">æŸ±çŠ¶å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                        <div class="chart-footer">
                            <span class="footer-stat">åˆè®¡ <strong>1.83äº¿</strong></span>
                            <span class="footer-trend up">â†‘ 12.5%</span>
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="ask('æ¢æˆæ¡å½¢å›¾','bar')">æ¢æ¡å½¢å›¾</button>
                        <button class="quick-btn" onclick="ask('æŸ¥çœ‹è¶‹åŠ¿','line')">çœ‹è¶‹åŠ¿</button>
                    </div>`
            };
        case 'stackedColumn':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-area">
                                <div class="chart-title">å„åŒºåŸŸäº§å“æ„æˆ</div>
                                <div class="chart-subtitle">2024å¹´12æœˆ Â· æŒ‰äº§å“ç±»å‹</div>
                            </div>
                            <a href="02-stacked-column/index.html" class="chart-badge purple">å †å æŸ±çŠ¶å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                        <div class="chart-footer">
                            <span class="footer-stat">äº§å“Aå æ¯” <strong>42%</strong></span>
                            <span class="footer-trend up">ä¸»åŠ›äº§å“</span>
                        </div>
                    </div>`
            };
        case 'bar':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-area">
                                <div class="chart-title">é”€é‡æ’è¡Œ TOP5</div>
                            </div>
                            <a href="03-bar/index.html" class="chart-badge green">æ¡å½¢å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                        <div class="insight-line">åä¸œåŒºé”€é‡æœ€é«˜ï¼Œå æ€»é‡çš„ <strong>28%</strong></div>
                    </div>`
            };
        case 'line':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div class="data-card-title">ğŸ“ˆ è¶‹åŠ¿æ¦‚è§ˆ</div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">æœ¬æœˆé”€å”®</div><div class="data-value">3,200</div><div class="data-trend">â†‘ 15.3%</div></div>
                            <div class="data-item"><div class="data-label">ç¯æ¯”å¢é•¿</div><div class="data-value">+420</div><div class="data-trend">ç¨³æ­¥ä¸Šå‡</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">æœˆåº¦è¶‹åŠ¿</div>
                            <a href="04-line/index.html" class="chart-badge blue">æŠ˜çº¿å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                    </div>`
            };
        case 'area':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">é”€å”®è¶‹åŠ¿</div>
                            <a href="05-area/index.html" class="chart-badge cyan" style="background:rgba(109,200,236,0.1);color:#6DC8EC;">é¢ç§¯å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                        <div class="chart-footer">
                            <span class="footer-stat">ç´¯è®¡ <strong>1.55äº¿</strong></span>
                            <span class="footer-trend up">æŒç»­å¢é•¿</span>
                        </div>
                    </div>`
            };
        case 'pie':
            return {
                chartId,
                html: `
                    <div class="ratio-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="ratio-title" style="margin-bottom:0;">ğŸ“Š æ¸ é“å æ¯”</div>
                            <a href="06-pie/index.html" class="chart-badge blue">é¥¼å›¾</a>
                        </div>
                        <div class="ratio-bar" style="margin-top:10px;">
                            <div class="ratio-segment" style="width:45%;background:#5B8FF9;"></div>
                            <div class="ratio-segment" style="width:32%;background:#5AD8A6;"></div>
                            <div class="ratio-segment" style="width:18%;background:#F6BD16;"></div>
                            <div class="ratio-segment" style="width:5%;background:#E86452;"></div>
                        </div>
                        <div class="ratio-legend">
                            <span class="ratio-legend-item"><span class="ratio-dot" style="background:#5B8FF9;"></span>çº¿ä¸Š 45%</span>
                            <span class="ratio-legend-item"><span class="ratio-dot" style="background:#5AD8A6;"></span>é—¨åº— 32%</span>
                            <span class="ratio-legend-item"><span class="ratio-dot" style="background:#F6BD16;"></span>åˆ†é”€ 18%</span>
                            <span class="ratio-legend-item"><span class="ratio-dot" style="background:#E86452;"></span>å…¶ä»– 5%</span>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-body" style="padding-top:16px;">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                    </div>`
            };
        case 'histogram':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div class="data-card-title">ğŸ“Š åˆ†å¸ƒæ¦‚è§ˆ</div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">å¹³å‡å€¼</div><div class="data-value">Â¥856</div></div>
                            <div class="data-item"><div class="data-label">ä¸­ä½æ•°</div><div class="data-value">Â¥720</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">è®¢å•é‡‘é¢åˆ†å¸ƒ</div>
                            <a href="07-histogram/index.html" class="chart-badge blue">ç›´æ–¹å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                        <div class="insight-line">å¤§éƒ¨åˆ†è®¢å•é›†ä¸­åœ¨ <strong>500-1000å…ƒ</strong> åŒºé—´</div>
                    </div>`
            };
        case 'bubble':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-area">
                                <div class="chart-title">äº§å“ä¸‰ç»´åˆ†æ</div>
                                <div class="chart-subtitle">é”€é‡ Ã— åˆ©æ¶¦ Ã— è§„æ¨¡</div>
                            </div>
                            <a href="09-bubble/index.html" class="chart-badge cyan" style="background:rgba(109,200,236,0.1);color:#6DC8EC;">æ°”æ³¡å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:260px;"></div>
                        </div>
                        <div class="insight-line">äº§å“Aé”€é‡é«˜ã€åˆ©æ¶¦å¥½ï¼Œæ˜¯ <strong>æ˜æ˜Ÿäº§å“</strong></div>
                    </div>`
            };
        case 'pareto':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div class="data-card-title">ğŸ“ˆ å¸•ç´¯æ‰˜åˆ†æ (80/20æ³•åˆ™)</div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">å…³é”®é—®é¢˜</div><div class="data-value">3ä¸ª</div></div>
                            <div class="data-item"><div class="data-label">å æ¯”å½±å“</div><div class="data-value" style="color:#E86452;">78%</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">é—®é¢˜ç±»å‹åˆ†æ</div>
                            <a href="13-pareto/index.html" class="chart-badge red">å¸•ç´¯æ‰˜å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:280px;"></div>
                        </div>
                        <div class="insight-line">ä¼˜å…ˆè§£å†³ <strong>è´¨é‡é—®é¢˜</strong> å’Œ <strong>äº¤ä»˜å»¶è¿Ÿ</strong></div>
                    </div>`
            };
        case 'wordcloud':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-area">
                                <div class="chart-title">çƒ­é—¨æœç´¢è¯</div>
                                <div class="chart-subtitle">è¿‘7å¤©ç”¨æˆ·æœç´¢</div>
                            </div>
                            <a href="15-wordcloud/index.html" class="chart-badge yellow">è¯äº‘</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                        <div class="insight-line">ã€Œ<strong>æ™ºèƒ½æ‰‹æœº</strong>ã€æœç´¢é‡æœ€é«˜ï¼Œè¾¾ <strong>12,580</strong> æ¬¡</div>
                    </div>`
            };
        case 'map':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">å„çœé”€å”®åˆ†å¸ƒ</div>
                            <a href="17-map/index.html" class="chart-badge gray">åœ°å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:280px;"></div>
                        </div>
                        <div class="insight-line"><strong>å¹¿ä¸œçœ</strong> é”€å”®é¢æœ€é«˜ï¼Œè¾¾ <strong>Â¥8,200ä¸‡</strong></div>
                    </div>`
            };
        case 'table':
            return {
                chartId: null,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸ“‹ é”€å”®æ˜ç»†æ•°æ®</div>
                            <a href="18-table/index.html" class="chart-badge gray">è¡¨æ ¼</a>
                        </div>
                        <div style="overflow-x:auto;margin-top:10px;">
                            <table style="width:100%;border-collapse:collapse;font-size:12px;">
                                <thead>
                                    <tr style="background:#F7F8FA;border-bottom:1px solid #E5E6EB;">
                                        <th style="padding:10px 8px;text-align:left;color:#646A73;font-weight:500;">äº§å“</th>
                                        <th style="padding:10px 8px;text-align:right;color:#646A73;font-weight:500;">é”€é‡</th>
                                        <th style="padding:10px 8px;text-align:right;color:#646A73;font-weight:500;">é‡‘é¢</th>
                                        <th style="padding:10px 8px;text-align:right;color:#646A73;font-weight:500;">ç¯æ¯”</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr style="border-bottom:1px solid #E5E6EB;">
                                        <td style="padding:10px 8px;">æ™ºèƒ½æ‰‹æœº</td>
                                        <td style="padding:10px 8px;text-align:right;font-weight:600;">3,580</td>
                                        <td style="padding:10px 8px;text-align:right;color:#5B8FF9;">Â¥2,148ä¸‡</td>
                                        <td style="padding:10px 8px;text-align:right;color:#5AD8A6;">â†‘ 15.3%</td>
                                    </tr>
                                    <tr style="border-bottom:1px solid #E5E6EB;">
                                        <td style="padding:10px 8px;">ç¬”è®°æœ¬ç”µè„‘</td>
                                        <td style="padding:10px 8px;text-align:right;font-weight:600;">2,240</td>
                                        <td style="padding:10px 8px;text-align:right;color:#5B8FF9;">Â¥1,792ä¸‡</td>
                                        <td style="padding:10px 8px;text-align:right;color:#5AD8A6;">â†‘ 8.7%</td>
                                    </tr>
                                    <tr style="border-bottom:1px solid #E5E6EB;">
                                        <td style="padding:10px 8px;">å¹³æ¿ç”µè„‘</td>
                                        <td style="padding:10px 8px;text-align:right;font-weight:600;">1,860</td>
                                        <td style="padding:10px 8px;text-align:right;color:#5B8FF9;">Â¥930ä¸‡</td>
                                        <td style="padding:10px 8px;text-align:right;color:#E86452;">â†“ 3.2%</td>
                                    </tr>
                                    <tr>
                                        <td style="padding:10px 8px;">æ™ºèƒ½æ‰‹è¡¨</td>
                                        <td style="padding:10px 8px;text-align:right;font-weight:600;">4,120</td>
                                        <td style="padding:10px 8px;text-align:right;color:#5B8FF9;">Â¥824ä¸‡</td>
                                        <td style="padding:10px 8px;text-align:right;color:#5AD8A6;">â†‘ 22.1%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="quick-btn" onclick="ask('ç”¨æŸ±çŠ¶å›¾å±•ç¤º','column')">æŸ±çŠ¶å›¾</button>
                        <button class="quick-btn" onclick="ask('æŸ¥çœ‹è¶‹åŠ¿','line')">çœ‹è¶‹åŠ¿</button>
                    </div>`
            };
        case 'indicator':
            return {
                chartId: null,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸ“Š å…³é”®ä¸šåŠ¡æŒ‡æ ‡</div>
                            <a href="19-indicator/index.html" class="chart-badge blue">æŒ‡æ ‡å¡</a>
                        </div>
                        <div class="data-grid" style="grid-template-columns:repeat(2,1fr);gap:12px;">
                            <div class="data-item">
                                <div class="data-label">æ€»é”€å”®é¢</div>
                                <div class="data-value" style="font-size:24px;">8,846</div>
                                <div style="font-size:11px;color:#646A73;">ä¸‡å…ƒ</div>
                                <div class="data-trend">â†‘ 12.5%</div>
                            </div>
                            <div class="data-item">
                                <div class="data-label">è®¢å•æ•°</div>
                                <div class="data-value" style="font-size:24px;">15,280</div>
                                <div style="font-size:11px;color:#646A73;">å•</div>
                                <div class="data-trend">â†‘ 8.3%</div>
                            </div>
                            <div class="data-item">
                                <div class="data-label">å®¢å•ä»·</div>
                                <div class="data-value" style="font-size:24px;">579</div>
                                <div style="font-size:11px;color:#646A73;">å…ƒ</div>
                                <div class="data-trend">â†‘ 3.8%</div>
                            </div>
                            <div class="data-item">
                                <div class="data-label">è½¬åŒ–ç‡</div>
                                <div class="data-value" style="font-size:24px;color:#5AD8A6;">6.8%</div>
                                <div style="font-size:11px;color:#646A73;"> </div>
                                <div class="data-trend">â†‘ 0.5pp</div>
                            </div>
                        </div>
                    </div>
                    <div class="insight-line" style="background:var(--card);border-radius:12px;margin-top:-4px;">æœ¬æœˆä¸šç»© <strong>è¶…é¢å®Œæˆ</strong>ï¼ŒåŒæ¯”å¢é•¿ <strong>12.5%</strong></div>`
            };
        case 'ring':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-area">
                                <div class="chart-title">å®Œæˆè¿›åº¦</div>
                                <div class="chart-subtitle">å¹´åº¦ç›®æ ‡è¾¾æˆ</div>
                            </div>
                            <a href="20-ring/index.html" class="chart-badge green">ç¯å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                        <div class="insight-line">å·²å®Œæˆ <strong>75%</strong>ï¼Œé¢„è®¡æå‰è¾¾æˆç›®æ ‡</div>
                    </div>`
            };
        case 'funnel':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title-area">
                                <div class="chart-title">ç”¨æˆ·è½¬åŒ–æ¼æ–—</div>
                                <div class="chart-subtitle">è´­ä¹°è·¯å¾„åˆ†æ</div>
                            </div>
                            <a href="11-funnel/index.html" class="chart-badge yellow">æ¼æ–—å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:300px;"></div>
                        </div>
                        <div class="insight-line">æ•´ä½“è½¬åŒ–ç‡ <strong>16%</strong>ï¼ŒåŠ è´­â†’ä¸‹å•ç¯èŠ‚éœ€ä¼˜åŒ–</div>
                    </div>`
            };
        case 'radar':
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">èƒ½åŠ›è¯„ä¼°</div>
                            <a href="10-radar/index.html" class="chart-badge purple">é›·è¾¾å›¾</a>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:220px;"></div>
                        </div>
                        <div class="insight-line">äº§å“èƒ½åŠ›çªå‡º <strong>85åˆ†</strong>ï¼Œå¸‚åœºèƒ½åŠ›æœ‰å¾…æå‡</div>
                    </div>`
            };
        case 'gauge':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">â±ï¸ ç›®æ ‡è¾¾æˆ</div>
                            <a href="12-gauge/index.html" class="chart-badge green">ä»ªè¡¨ç›˜</a>
                        </div>
                        <div style="text-align:center;padding:20px 0;">
                            <div style="font-size:48px;font-weight:700;color:#5AD8A6;">75%</div>
                            <div style="font-size:12px;color:var(--text-2);margin-top:4px;">å¹´åº¦é”€å”®ç›®æ ‡</div>
                        </div>
                        <div class="ratio-bar" style="height:6px;">
                            <div class="ratio-segment" style="width:75%;background:linear-gradient(90deg,#5AD8A6,#5B8FF9);border-radius:3px;"></div>
                        </div>
                    </div>`
            };
        case 'progress':
            return {
                chartId: null,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸ“¶ é¡¹ç›®è¿›åº¦</div>
                            <a href="26-progress/index.html" class="chart-badge blue">è¿›åº¦æ¡</a>
                        </div>
                        <div style="margin-top:12px;">
                            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;"><span style="color:var(--text-2);">éœ€æ±‚åˆ†æ</span><span style="color:#5AD8A6;font-weight:600;">100%</span></div>
                            <div class="ratio-bar" style="height:6px;margin-bottom:12px;"><div class="ratio-segment" style="width:100%;background:#5AD8A6;border-radius:3px;"></div></div>
                            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;"><span style="color:var(--text-2);">è®¾è®¡å¼€å‘</span><span style="color:#5B8FF9;font-weight:600;">70%</span></div>
                            <div class="ratio-bar" style="height:6px;margin-bottom:12px;"><div class="ratio-segment" style="width:70%;background:#5B8FF9;border-radius:3px;"></div></div>
                            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:4px;"><span style="color:var(--text-2);">æµ‹è¯•ä¸Šçº¿</span><span style="color:#F6BD16;font-weight:600;">30%</span></div>
                            <div class="ratio-bar" style="height:6px;"><div class="ratio-segment" style="width:30%;background:#F6BD16;border-radius:3px;"></div></div>
                        </div>
                    </div>`
            };
        case 'heatmap':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸ”¥ ç”¨æˆ·æ´»è·ƒæ—¶æ®µ</div>
                            <a href="16-heatmap/index.html" class="chart-badge red">çƒ­åŠ›å›¾</a>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">é«˜å³°æ—¶æ®µ</div><div class="data-value">å‘¨ä¸‰ 15:00</div></div>
                            <div class="data-item"><div class="data-label">æ—¥å‡è®¿é—®</div><div class="data-value" style="color:#E86452;">12.8ä¸‡</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:240px;"></div>
                        </div>
                        <div class="insight-line">å»ºè®®åœ¨ <strong>å‘¨ä¸‰ä¸‹åˆ</strong> è¿›è¡Œé‡è¦æ´»åŠ¨æ¨å¹¿</div>
                    </div>`
            };
        case 'treemap':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸ·ï¸ å“ç±»é”€å”®æ„æˆ</div>
                            <a href="14-treemap/index.html" class="chart-badge yellow">çŸ©å½¢æ ‘å›¾</a>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">å“ç±»æ•°</div><div class="data-value">8ä¸ª</div></div>
                            <div class="data-item"><div class="data-label">TOP1</div><div class="data-value" style="color:#5B8FF9;">æ•°ç äº§å“</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:240px;"></div>
                        </div>
                        <div class="insight-line">æ•°ç äº§å“å æ¯” <strong>35%</strong>ï¼Œæ˜¯ä¸»åŠ›å“ç±»</div>
                    </div>`
            };
        case 'scatter':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸ“ˆ é”€å”®-åˆ©æ¶¦ç›¸å…³æ€§</div>
                            <a href="08-scatter/index.html" class="chart-badge purple">æ•£ç‚¹å›¾</a>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">ç›¸å…³ç³»æ•°</div><div class="data-value">0.78</div></div>
                            <div class="data-item"><div class="data-label">å¼‚å¸¸ç‚¹</div><div class="data-value" style="color:#E86452;">3ä¸ª</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:240px;"></div>
                        </div>
                        <div class="insight-line">å­˜åœ¨ <strong>3ä¸ª</strong> é«˜é”€å”®ä½åˆ©æ¶¦äº§å“ï¼Œå»ºè®®å…³æ³¨å®šä»·ç­–ç•¥</div>
                    </div>`
            };
        case 'waterfall':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸ’° åˆ©æ¶¦æ„æˆåˆ†æ</div>
                            <a href="21-waterfall/index.html" class="chart-badge green">ç€‘å¸ƒå›¾</a>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">æ€»æ”¶å…¥</div><div class="data-value">5,200ä¸‡</div></div>
                            <div class="data-item"><div class="data-label">å‡€åˆ©æ¶¦</div><div class="data-value" style="color:#5AD8A6;">2,100ä¸‡</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:240px;"></div>
                        </div>
                        <div class="insight-line">åˆ©æ¶¦ç‡ <strong>40.4%</strong>ï¼Œæˆæœ¬æ§åˆ¶è‰¯å¥½</div>
                    </div>`
            };
        case 'dualAxes':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸ“Š é”€é‡ä¸å¢é•¿ç‡å¯¹æ¯”</div>
                            <a href="22-dual-axes/index.html" class="chart-badge purple">åŒè½´å›¾</a>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">ç´¯è®¡é”€å”®</div><div class="data-value">3.2äº¿</div></div>
                            <div class="data-item"><div class="data-label">å¹³å‡å¢é•¿</div><div class="data-value" style="color:#5AD8A6;">+15.3%</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:260px;"></div>
                        </div>
                        <div class="insight-line">6æœˆé”€é‡æœ€é«˜ï¼Œå¢é•¿ç‡å‘ˆ <strong>ä¸Šå‡è¶‹åŠ¿</strong></div>
                    </div>`
            };
        case 'rose':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸŒ¹ å®¢æˆ·æ¥æºåˆ†æ</div>
                            <a href="23-rose/index.html" class="chart-badge purple">ç«ç‘°å›¾</a>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">ä¸»è¦æ¥æº</div><div class="data-value">çº¿ä¸Šæ¸ é“</div></div>
                            <div class="data-item"><div class="data-label">å æ¯”</div><div class="data-value" style="color:#5B8FF9;">45%</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:260px;"></div>
                        </div>
                        <div class="insight-line">çº¿ä¸Šæ¸ é“è´¡çŒ®æœ€å¤§ï¼Œå»ºè®® <strong>åŠ å¤§çº¿ä¸ŠæŠ•æ”¾</strong></div>
                    </div>`
            };
        case 'sankey':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">ğŸŒŠ ç”¨æˆ·æµå‘åˆ†æ</div>
                            <a href="25-sankey/index.html" class="chart-badge cyan" style="background:rgba(109,200,236,0.1);color:#6DC8EC;">æ¡‘åŸºå›¾</a>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">ä¸»è¦å…¥å£</div><div class="data-value">æœç´¢å¼•æ“</div></div>
                            <div class="data-item"><div class="data-label">è½¬åŒ–ç‡</div><div class="data-value" style="color:#5AD8A6;">23.5%</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-subtitle" style="color:#1D1D1F;font-size:11px;">æ¸ é“ â†’ è¡Œä¸º â†’ ç»“æœ</div>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:260px;"></div>
                        </div>
                        <div class="insight-line">æœç´¢å¼•æ“ç”¨æˆ·è½¬åŒ–æœ€é«˜ï¼Œ<strong>ROI è¾¾ 3.2</strong></div>
                    </div>`
            };
        case 'sunburst':
            return {
                chartId,
                html: `
                    <div class="data-card">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div class="data-card-title" style="margin-bottom:0;">â˜€ï¸ ç»„ç»‡æ¶æ„åˆ†å¸ƒ</div>
                            <a href="24-sunburst/index.html" class="chart-badge yellow">æ—­æ—¥å›¾</a>
                        </div>
                        <div class="data-grid">
                            <div class="data-item"><div class="data-label">éƒ¨é—¨æ•°</div><div class="data-value">6ä¸ª</div></div>
                            <div class="data-item"><div class="data-label">æœ€å¤§å›¢é˜Ÿ</div><div class="data-value" style="color:#5B8FF9;">æŠ€æœ¯éƒ¨</div></div>
                        </div>
                    </div>
                    <div class="chart-card">
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box" style="height:260px;"></div>
                        </div>
                        <div class="insight-line">æŠ€æœ¯éƒ¨äººæ•°æœ€å¤šï¼Œå æ¯” <strong>35%</strong></div>
                    </div>`
            };
        default:
            return {
                chartId,
                html: `
                    <div class="chart-card">
                        <div class="chart-header">
                            <div class="chart-title">æ•°æ®åˆ†æ</div>
                            <span class="chart-badge blue">å›¾è¡¨</span>
                        </div>
                        <div class="chart-body">
                            <div id="${chartId}" class="chart-box"></div>
                        </div>
                    </div>`
            };
    }
}

function renderChart(id, type) {
    const { Column, Bar, Line, Area, Pie, Rose, Scatter, Radar, Treemap, Heatmap, Waterfall, DualAxes, Sankey, Sunburst, Histogram, WordCloud, Funnel } = G2Plot;
    
    const colData = [
        { x: 'åä¸œ', y: 3650 }, { x: 'ååŒ—', y: 2808 }, { x: 'åå—', y: 2408 },
        { x: 'åä¸­', y: 2236 }, { x: 'è¥¿åŒ—', y: 1500 }, { x: 'è¥¿å—', y: 1648 }
    ];
    const lineData = [
        { x: '1æœˆ', y: 2100 }, { x: '2æœˆ', y: 2350 }, { x: '3æœˆ', y: 2580 },
        { x: '4æœˆ', y: 2460 }, { x: '5æœˆ', y: 2780 }, { x: '6æœˆ', y: 3200 }
    ];
    const pieData = [
        { type: 'çº¿ä¸Š', value: 45 }, { type: 'é—¨åº—', value: 32 },
        { type: 'åˆ†é”€', value: 18 }, { type: 'å…¶ä»–', value: 5 }
    ];
    // å †å æŸ±çŠ¶å›¾æ•°æ®
    const stackedData = [
        { x: 'åä¸œ', y: 1800, type: 'äº§å“A' }, { x: 'åä¸œ', y: 1200, type: 'äº§å“B' }, { x: 'åä¸œ', y: 650, type: 'äº§å“C' },
        { x: 'ååŒ—', y: 1400, type: 'äº§å“A' }, { x: 'ååŒ—', y: 900, type: 'äº§å“B' }, { x: 'ååŒ—', y: 508, type: 'äº§å“C' },
        { x: 'åå—', y: 1200, type: 'äº§å“A' }, { x: 'åå—', y: 750, type: 'äº§å“B' }, { x: 'åå—', y: 458, type: 'äº§å“C' },
        { x: 'åä¸­', y: 1000, type: 'äº§å“A' }, { x: 'åä¸­', y: 800, type: 'äº§å“B' }, { x: 'åä¸­', y: 436, type: 'äº§å“C' }
    ];
    // ç›´æ–¹å›¾æ•°æ®
    const histogramData = Array.from({ length: 100 }, () => ({ value: Math.floor(Math.random() * 1500) + 200 }));
    // æ°”æ³¡å›¾æ•°æ®
    const bubbleData = [
        { x: 80, y: 45, size: 3200, cat: 'äº§å“A' }, { x: 65, y: 38, size: 2800, cat: 'äº§å“B' },
        { x: 50, y: 55, size: 1800, cat: 'äº§å“C' }, { x: 35, y: 25, size: 2200, cat: 'äº§å“D' },
        { x: 70, y: 30, size: 1500, cat: 'äº§å“E' }, { x: 45, y: 42, size: 2600, cat: 'äº§å“F' }
    ];
    // å¸•ç´¯æ‰˜å›¾æ•°æ®
    const paretoData = [
        { x: 'è´¨é‡é—®é¢˜', y: 45, rate: 45 }, { x: 'äº¤ä»˜å»¶è¿Ÿ', y: 25, rate: 70 },
        { x: 'ä»·æ ¼äº‰è®®', y: 12, rate: 82 }, { x: 'æœåŠ¡æ€åº¦', y: 10, rate: 92 },
        { x: 'å…¶ä»–', y: 8, rate: 100 }
    ];
    // è¯äº‘æ•°æ®
    const wordcloudData = [
        { word: 'æ™ºèƒ½æ‰‹æœº', weight: 100 }, { word: 'ç¬”è®°æœ¬', weight: 85 }, { word: 'å¹³æ¿ç”µè„‘', weight: 70 },
        { word: 'æ™ºèƒ½æ‰‹è¡¨', weight: 65 }, { word: 'è€³æœº', weight: 58 }, { word: 'å……ç”µå™¨', weight: 45 },
        { word: 'æ‰‹æœºå£³', weight: 42 }, { word: 'æ•°æ®çº¿', weight: 38 }, { word: 'è“ç‰™éŸ³ç®±', weight: 35 },
        { word: 'ç§»åŠ¨ç”µæº', weight: 32 }, { word: 'é”®ç›˜', weight: 28 }, { word: 'é¼ æ ‡', weight: 25 }
    ];
    
    // ===== ç§»åŠ¨ç«¯å‚æ•°è§„èŒƒ (å‚è€ƒ mobile-spec.html) =====
    const fontSize = 10;           // ç»Ÿä¸€è½´æ ‡ç­¾å­—å·
    const labelFontSize = 10;      // å›¾è¡¨å†…æ ‡ç­¾å­—å·
    const bindRadius = 3;          // æŸ±çŠ¶å›¾åœ†è§’
    const lineWidth = 1.5;         // çº¿æ¡å®½åº¦ (ç§»åŠ¨ç«¯)
    const pointSize = 3;           // æ•°æ®ç‚¹å¤§å° (ç§»åŠ¨ç«¯)
    const circleRadius = 0.8;      // åœ†å½¢å›¾è¡¨åŠå¾„ (ç§»åŠ¨ç«¯)
    const basePadding = [20, 15, 35, 40]; // ç»Ÿä¸€åŸºç¡€padding
    
    const axisStyle = { label: { style: { fontSize, fill: '#1D1D1F' } } };
    const gridStyle = { line: { style: { stroke: '#E8E8ED', lineDash: [4, 4] } } };

    try {
        let chart;
        switch(type) {
            case 'column':
                chart = new Column(id, {
                    data: colData, xField: 'x', yField: 'y',
                    padding: basePadding,
                    color: '#5B8FF9',
                    columnWidthRatio: 0.6,  // ç§»åŠ¨ç«¯ 0.6
                    columnStyle: { radius: [bindRadius, bindRadius, 0, 0] },
                    label: { position: 'top', style: { fill: '#5B8FF9', fontSize: labelFontSize } },
                    xAxis: { ...axisStyle, line: { style: { stroke: '#E8E8ED' } }, tickLine: null },
                    yAxis: { ...axisStyle, grid: gridStyle, line: null, tickLine: null },
                    legend: false
                });
                break;
            case 'stackedColumn':
                chart = new Column(id, {
                    data: stackedData, xField: 'x', yField: 'y', seriesField: 'type',
                    isStack: true,
                    padding: basePadding,
                    color: ['#5B8FF9', '#5AD8A6', '#F6BD16'],
                    columnWidthRatio: 0.6,  // ç§»åŠ¨ç«¯ 0.6
                    columnStyle: { radius: 0 },  // å †å æŸ±çŠ¶å›¾æ— åœ†è§’
                    xAxis: { ...axisStyle, line: { style: { stroke: '#E8E8ED' } }, tickLine: null },
                    yAxis: { ...axisStyle, grid: gridStyle, line: null, tickLine: null },
                    legend: false
                });
                break;
            case 'bar':
                chart = new Bar(id, {
                    data: colData.slice(0, 5), xField: 'y', yField: 'x',
                    padding: [15, 45, 15, 50],
                    color: '#5B8FF9',
                    barWidthRatio: 0.55,  // ç§»åŠ¨ç«¯ 0.55
                    barStyle: { radius: [0, bindRadius, bindRadius, 0] },
                    label: { position: 'right', style: { fill: '#5B8FF9', fontSize: labelFontSize } },
                    xAxis: { ...axisStyle },
                    yAxis: { ...axisStyle, line: null },
                    legend: false
                });
                break;
            case 'line':
                chart = new Line(id, {
                    data: lineData, xField: 'x', yField: 'y',
                    padding: basePadding,
                    color: '#5B8FF9',
                    lineStyle: { lineWidth },  // ç§»åŠ¨ç«¯ 1.5
                    point: { size: pointSize, style: { fill: '#5B8FF9', stroke: '#fff', lineWidth: 1.5 } },  // ç§»åŠ¨ç«¯ size: 3
                    xAxis: { ...axisStyle, line: { style: { stroke: '#E8E8ED' } }, tickLine: null },
                    yAxis: { ...axisStyle, grid: gridStyle, line: null },
                    legend: false
                });
                break;
            case 'area':
                chart = new Area(id, {
                    data: lineData, xField: 'x', yField: 'y',
                    padding: basePadding,
                    color: '#5AD8A6',
                    smooth: true,
                    areaStyle: { fillOpacity: 0.3 },  // ç§»åŠ¨ç«¯ 0.25-0.3
                    line: { style: { lineWidth } },
                    xAxis: { ...axisStyle, line: { style: { stroke: '#E8E8ED' } }, tickLine: null },
                    yAxis: { ...axisStyle, grid: gridStyle, line: null },
                    legend: false
                });
                break;
            case 'pie':
                chart = new Pie(id, {
                    data: pieData, angleField: 'value', colorField: 'type',
                    radius: 0.85,  // ç§»åŠ¨ç«¯ 0.85
                    padding: [15, 15, 15, 15],
                    color: COLORS,
                    label: { 
                        type: 'spider',
                        content: '{name} {percentage}',
                        style: { fontSize: labelFontSize },
                        labelLine: { style: { lineWidth: 1, stroke: '#aaa' } }
                    },
                    legend: false
                });
                break;
            case 'histogram':
                chart = new Histogram(id, {
                    data: histogramData, binField: 'value',
                    binNumber: 8,  // ç§»åŠ¨ç«¯ 8
                    padding: basePadding,
                    color: '#5B8FF9',
                    columnStyle: { radius: [bindRadius, bindRadius, 0, 0] },
                    xAxis: { ...axisStyle, line: { style: { stroke: '#E8E8ED' } }, tickLine: null },
                    yAxis: { ...axisStyle, grid: gridStyle, line: null, tickLine: null },
                    legend: false
                });
                break;
            case 'bubble':
                chart = new Scatter(id, {
                    data: bubbleData, xField: 'x', yField: 'y', sizeField: 'size', colorField: 'cat',
                    size: [8, 28],  // è¿›ä¸€æ­¥ç¼©å°æ°”æ³¡
                    padding: [40, 40, 50, 50],  // æ›´å¤§çš„padding
                    color: COLORS.slice(0, 6),
                    shape: 'circle',
                    pointStyle: { fillOpacity: 0.65, stroke: '#fff', lineWidth: 1 },
                    xAxis: { ...axisStyle, min: 15, max: 100, grid: gridStyle },
                    yAxis: { ...axisStyle, min: 10, max: 70, grid: gridStyle },
                    legend: false
                });
                break;
            case 'pareto':
                // å¸•ç´¯æ‰˜å›¾æ•°æ®
                const paretoRaw = [{ type: 'ç¼ºé™·A', value: 120 }, { type: 'ç¼ºé™·B', value: 85 }, { type: 'ç¼ºé™·C', value: 45 }, { type: 'ç¼ºé™·D', value: 30 }];
                const paretoTotal = paretoRaw.reduce((s, d) => s + d.value, 0);
                let cumulative = 0;
                const paretoLine = paretoRaw.map(d => { cumulative += d.value; return { type: d.type, percent: cumulative / paretoTotal }; });
                chart = new DualAxes(id, {
                    data: [paretoRaw, paretoLine], xField: 'type', yField: ['value', 'percent'],
                    padding: [20, 30, 35, 30],
                    geometryOptions: [
                        { geometry: 'column', color: '#5B8FF9', columnWidthRatio: 0.6, columnStyle: { radius: [bindRadius, bindRadius, 0, 0] } },
                        { geometry: 'line', color: '#5AD8A6', lineStyle: { lineWidth }, point: { size: pointSize, style: { fill: '#5AD8A6', stroke: '#fff', lineWidth: 2 } } }
                    ],
                    xAxis: { ...axisStyle },
                    yAxis: { 
                        value: { ...axisStyle }, 
                        percent: { ...axisStyle, label: { formatter: v => (v * 100).toFixed(0) + '%' } } 
                    },
                    legend: false
                });
                break;
            case 'wordcloud':
                chart = new WordCloud(id, {
                    data: wordcloudData, wordField: 'word', weightField: 'weight', colorField: 'word',
                    padding: [15, 15, 15, 15],
                    color: COLORS,
                    wordStyle: {
                        fontSize: [16, 48],  // ç§»åŠ¨ç«¯ [16, 48]
                        rotation: 0,
                        fontWeight: 600
                    },
                    random: () => 0.5
                });
                break;
            case 'funnel':
                const funnelData = [
                    { stage: 'æµè§ˆ', value: 5000 },
                    { stage: 'ç‚¹å‡»', value: 3500 },
                    { stage: 'åŠ è´­', value: 2100 },
                    { stage: 'ä¸‹å•', value: 1200 },
                    { stage: 'æ”¯ä»˜', value: 800 },
                ];
                chart = new Funnel(id, {
                    data: funnelData,
                    xField: 'stage',
                    yField: 'value',
                    shape: 'funnel',
                    dynamicHeight: false,
                    padding: [10, 5, 10, 5],
                    color: ['#5B8FF9', '#61DDAA', '#65789B', '#F6BD16', '#E86452'],
                    legend: false,
                    label: {
                        formatter: (d) => `${d.stage}\n${(d.value/1000).toFixed(1)}k`,
                        style: { fontSize: 12, fill: '#fff', fontWeight: 600, textAlign: 'center' },
                    },
                    conversionTag: {
                        formatter: (datum) => `${((datum.$$percentage$$) * 100).toFixed(0)}%`,
                        style: { fontSize: 10, fill: '#8C8C8C' },
                    },
                    funnelStyle: {
                        stroke: '#fff',
                        lineWidth: 2,
                    },
                });
                break;
            case 'map':
                // åœ°å›¾ä½¿ç”¨ ECharts æ¸²æŸ“
                renderMapChart(id);
                return;
            case 'ring':
                chart = new Pie(id, {
                    data: [{ type: 'å·²å®Œæˆ', value: 75 }, { type: 'æœªå®Œæˆ', value: 25 }],
                    angleField: 'value', colorField: 'type',
                    radius: circleRadius, innerRadius: 0.55,  // ç§»åŠ¨ç«¯ innerRadius: 0.55
                    padding: [15, 15, 15, 15],
                    color: ['#5AD8A6', '#E8E8ED'],
                    statistic: {
                        title: { content: 'æ€»è®¡', style: { fontSize: '11px', color: '#1D1D1F' } },
                        content: { content: '75%', style: { fontSize: '20px', fontWeight: 600, color: '#5AD8A6' } }  // ç§»åŠ¨ç«¯ 16-20px
                    },
                    legend: false
                });
                break;
            case 'radar':
                chart = new Radar(id, {
                    data: [{ item: 'æŠ€æœ¯', score: 80 }, { item: 'è®¾è®¡', score: 70 }, { item: 'äº§å“', score: 85 }, { item: 'è¿è¥', score: 75 }, { item: 'å¸‚åœº', score: 65 }],
                    xField: 'item', yField: 'score',
                    padding: [30, 30, 30, 30],
                    color: '#5B8FF9',
                    area: { style: { fillOpacity: 0.3 } },
                    point: { size: pointSize, style: { fill: '#5B8FF9', stroke: '#fff', lineWidth: 1.5 } },  // ç§»åŠ¨ç«¯ point.size: 3
                    xAxis: { label: { style: { fontSize: labelFontSize } } },
                    legend: false
                });
                break;
            case 'heatmap':
                const days = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”'];
                const hours = ['9:00', '12:00', '15:00', '18:00'];
                const heatData = [];
                days.forEach(d => { hours.forEach(h => { heatData.push({ day: d, hour: h, value: Math.floor(Math.random() * 100) }); }); });
                chart = new Heatmap(id, {
                    data: heatData, xField: 'hour', yField: 'day', colorField: 'value',
                    padding: [15, 20, 35, 50],
                    color: ['#E8F4FD', '#5B8FF9', '#3D5A99'],
                    shape: 'rect',
                    xAxis: { ...axisStyle, tickLine: null },
                    yAxis: { ...axisStyle },
                    legend: false
                });
                break;
            case 'treemap':
                chart = new Treemap(id, {
                    data: { name: 'root', children: pieData.map(d => ({ name: d.type, value: d.value })) },
                    colorField: 'name',
                    padding: [15, 15, 15, 15],
                    color: COLORS,
                    label: { style: { fontSize: labelFontSize + 1, fill: '#fff', fontWeight: 500 } },
                    rectStyle: { lineWidth: 2, stroke: '#fff' },
                    legend: false
                });
                break;
            case 'scatter':
                const scatterData = Array.from({ length: 30 }, () => ({ 
                    x: Math.random() * 100, 
                    y: Math.random() * 100, 
                    cat: Math.random() > 0.5 ? 'Aç±»' : 'Bç±»' 
                }));
                chart = new Scatter(id, {
                    data: scatterData,
                    xField: 'x',
                    yField: 'y',
                    colorField: 'cat',
                    size: pointSize + 2,  // ç§»åŠ¨ç«¯ size: 4-5
                    shape: 'circle',
                    color: ['#5B8FF9', '#5AD8A6'],
                    pointStyle: { fillOpacity: 0.8, stroke: '#fff', lineWidth: 1.5 },
                    padding: basePadding,
                    xAxis: { ...axisStyle, grid: gridStyle },
                    yAxis: { ...axisStyle, grid: gridStyle },
                    legend: false,
                });
                break;
            case 'waterfall':
                chart = new Waterfall(id, {
                    data: [{ type: 'æ”¶å…¥', value: 52 }, { type: 'æˆæœ¬', value: -21 }, { type: 'è´¹ç”¨', value: -10 }, { type: 'åˆ©æ¶¦', value: null }],
                    xField: 'type', yField: 'value',
                    padding: basePadding,
                    risingFill: '#5B8FF9', fallingFill: '#E86452',
                    total: { label: 'åˆ©æ¶¦', style: { fill: '#5D7092' } },
                    columnWidthRatio: 0.55,  // ç§»åŠ¨ç«¯ 0.55
                    label: { position: 'middle', style: { fill: '#fff', fontSize: labelFontSize, fontWeight: 500 } },
                    xAxis: { ...axisStyle }, 
                    yAxis: { ...axisStyle, grid: gridStyle },
                    legend: false
                });
                break;
            case 'dualAxes':
                chart = new DualAxes(id, {
                    data: [lineData, lineData], xField: 'x', yField: ['y', 'y'],
                    padding: [20, 25, 35, 25],
                    geometryOptions: [
                        { geometry: 'column', color: '#5B8FF9', columnWidthRatio: 0.55, columnStyle: { radius: [bindRadius, bindRadius, 0, 0] } },  // ç§»åŠ¨ç«¯ 0.55
                        { geometry: 'line', color: '#E86452', lineStyle: { lineWidth }, point: { size: pointSize, style: { fill: '#E86452', stroke: '#fff', lineWidth: 2 } } }
                    ],
                    xAxis: { ...axisStyle },
                    yAxis: { y: { ...axisStyle } },
                    legend: false
                });
                break;
            case 'rose':
                chart = new Rose(id, {
                    data: pieData, xField: 'type', yField: 'value', seriesField: 'type',
                    radius: 0.88, innerRadius: 0.2,  // ç§»åŠ¨ç«¯ radius: 0.88, innerRadius: 0.2
                    padding: [15, 15, 15, 15],
                    color: COLORS,
                    label: { 
                        offset: 15,
                        formatter: (datum) => datum.type,
                        style: { fontSize: labelFontSize, fill: '#1D1D1F' },
                        labelLine: { style: { lineWidth: 1, stroke: '#aaa' } }
                    },
                    legend: false
                });
                break;
            case 'sankey':
                const sankeyData = [
                    { source: 'æœç´¢', target: 'é¦–é¡µ', value: 45 }, { source: 'ç¤¾äº¤', target: 'é¦–é¡µ', value: 25 },
                    { source: 'é¦–é¡µ', target: 'æµè§ˆ', value: 60 }, { source: 'é¦–é¡µ', target: 'æµå¤±', value: 10 },
                    { source: 'æµè§ˆ', target: 'è´­ä¹°', value: 30 }, { source: 'æµè§ˆ', target: 'æµå¤±', value: 30 }
                ];
                chart = new Sankey(id, {
                    data: sankeyData,
                    sourceField: 'source', targetField: 'target', weightField: 'value',
                    padding: [25, 25, 25, 25],
                    color: COLORS,
                    nodeWidthRatio: 0.02,  // ç§»åŠ¨ç«¯ 0.02
                    nodePaddingRatio: 0.02,
                    nodeStyle: { fillOpacity: 1 }, 
                    edgeStyle: { fillOpacity: 0.45 },  // ç§»åŠ¨ç«¯ 0.45
                    label: { style: { fill: '#1D1D1F', fontSize: labelFontSize, fontWeight: 500 } },
                    legend: false
                });
                break;
            case 'sunburst':
                chart = new Sunburst(id, {
                    data: { name: 'æ€»éƒ¨', children: [{ name: 'ç ”å‘', children: [{ name: 'å‰ç«¯', value: 30 }, { name: 'åç«¯', value: 40 }] }, { name: 'é”€å”®', children: [{ name: 'åä¸œ', value: 25 }, { name: 'åå—', value: 20 }] }] },
                    innerRadius: 0.2,  // ç§»åŠ¨ç«¯ 0.2
                    padding: [20, 20, 20, 20],
                    hierarchyConfig: { field: 'value' },
                    color: COLORS,
                    sunburstStyle: { stroke: '#fff', lineWidth: 2 },
                    label: { layout: [{ type: 'limit-in-shape' }], style: { fontSize: labelFontSize, fill: '#fff', fontWeight: 500 } },
                    legend: false
                });
                break;
        }
        if (chart) chart.render();
    } catch (e) { console.error('Chart render error:', type, e); }
}

// åœ°å›¾æ¸²æŸ“å‡½æ•° (ä½¿ç”¨ ECharts çœŸå®åœ°å›¾)
async function renderMapChart(id) {
    const el = document.getElementById(id);
    if (!el) return;
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    el.innerHTML = '<div style="height:100%;display:flex;align-items:center;justify-content:center;color:#1D1D1F;font-size:11px;">åŠ è½½åœ°å›¾ä¸­...</div>';
    
    try {
        // å°è¯•åŠ è½½æœ¬åœ° GeoJSON
        const geoJsonSources = [
            '17-map/china.json',
            'https://cdn.jsdelivr.net/npm/echarts@5.4.3/map/json/china.json'
        ];
        
        let geoJson = null;
        for (const url of geoJsonSources) {
            try {
                const response = await fetch(url);
                if (response.ok) {
                    geoJson = await response.json();
                    if (geoJson && geoJson.features) break;
                }
            } catch (e) { continue; }
        }
        
        if (!geoJson || !geoJson.features) {
            throw new Error('æ— æ³•åŠ è½½åœ°å›¾æ•°æ®');
        }
        
        // æ³¨å†Œåœ°å›¾
        echarts.registerMap('china', geoJson);
        
        // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
        const provinceNames = geoJson.features
            .map(f => f.properties?.name)
            .filter(name => name && name !== 'ä¸­åäººæ°‘å…±å’Œå›½');
        
        const mapData = provinceNames.map(name => ({
            name: name,
            value: Math.round(Math.random() * 8000 + 500)
        }));
        
        // æ¸…ç©ºå®¹å™¨å¹¶åˆå§‹åŒ– ECharts
        el.innerHTML = '';
        const chart = echarts.init(el);
        
        const option = {
            tooltip: {
                trigger: 'item',
                backgroundColor: 'rgba(255,255,255,0.95)',
                borderColor: '#E8E8ED',
                borderWidth: 1,
                padding: [8, 12],
                textStyle: { color: '#1D1D1F', fontSize: 10 },
                formatter: params => `${params.name.replace(/çœ|å¸‚|è‡ªæ²»åŒº|ç‰¹åˆ«è¡Œæ”¿åŒº|å£®æ—|å›æ—|ç»´å¾å°”/g, '')}: ${params.value ? params.value.toLocaleString() : 0} ä¸‡å…ƒ`
            },
            visualMap: {
                show: false,
                min: 0,
                max: 8000,
                inRange: { color: ['#E8F4FD', '#7CB8F7', '#5B8FF9', '#3D6DD8'] }
            },
            series: [{
                type: 'map',
                map: 'china',
                roam: true,
                zoom: 1.0,
                center: [104, 36],
                scaleLimit: { min: 0.8, max: 3 },
                label: { show: false },
                itemStyle: { areaColor: '#f5f5f5', borderColor: '#fff', borderWidth: 0.5 },
                emphasis: {
                    label: { show: true, color: '#fff', fontSize: 8 },
                    itemStyle: { areaColor: '#5B8FF9', shadowColor: 'rgba(91,143,249,0.4)', shadowBlur: 10 }
                },
                data: mapData
            }]
        };
        
        chart.setOption(option);
        
        // å“åº”å¼
        const resizeObserver = new ResizeObserver(() => chart.resize());
        resizeObserver.observe(el);
        
    } catch (error) {
        console.error('åœ°å›¾åŠ è½½å¤±è´¥:', error);
        el.innerHTML = `<div style="height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#1D1D1F;font-size:11px;background:#F5F5F7;border-radius:8px;gap:8px;">
            <span>ğŸ—ºï¸ åœ°å›¾åŠ è½½å¤±è´¥</span>
            <button onclick="renderMapChart('${id}')" style="padding:4px 12px;background:#5B8FF9;color:#fff;border:none;border-radius:4px;font-size:10px;cursor:pointer;">é‡è¯•</button>
        </div>`;
    }
}

function scrollToBottom() {
    setTimeout(() => {
        document.getElementById('chatArea').scrollTo({ top: 999999, behavior: 'smooth' });
    }, 50);
}

window.onload = initPrompts;
</script>
</body>
</html>
