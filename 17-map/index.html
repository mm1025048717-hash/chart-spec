<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å›¾ - å›¾è¡¨è®¾è®¡è§„èŒƒ</title>
    <!-- L7Plot ä¾èµ– -->
    <script src="https://unpkg.com/@antv/l7plot@latest/dist/l7plot.min.js"></script>
    <link rel="stylesheet" href="../common.css">
    <style>
        .chart-type-badge {
            display: inline-flex; align-items: center; gap: 8px;
            background: linear-gradient(135deg, #E6F7F0 0%, #C8F0E0 100%);
            padding: 8px 16px; border-radius: 20px; margin-bottom: 24px;
        }
        .chart-type-badge .icon { font-size: 20px; }
        .chart-type-badge .text { font-size: 14px; color: #00A854; font-weight: 500; }
        
        .map-demo-container {
            background: #FFF;
            border-radius: 24px;
            border: 1px solid var(--border-light);
            overflow: hidden;
            margin-bottom: 32px;
        }
        
        .map-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .map-canvas {
            height: 500px;
            width: 100%;
            background: #f0f2f5;
            position: relative;
        }

        .api-key-mask {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(4px);
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }

        .api-key-input {
            margin-top: 20px;
            padding: 12px 20px;
            border: 1px solid #d9d9d9;
            border-radius: 8px;
            width: 300px;
            font-size: 14px;
        }

        .btn-run {
            margin-top: 16px;
            padding: 10px 24px;
            background: #0071E3;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
        }

        .map-types { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin: 24px 0; }
        .map-type-card {
            background: #FFF; padding: 24px; border-radius: 16px; text-align: center;
            border: 1px solid var(--border-light); transition: all 0.3s ease;
        }
        .map-type-card:hover { transform: translateY(-4px); box-shadow: var(--shadow-md); }
        .map-type-card .icon { font-size: 32px; margin-bottom: 12px; }
        .map-type-card .name { font-weight: 600; margin-bottom: 4px; font-size: 16px; }
        .map-type-card .desc { font-size: 13px; color: var(--text-secondary); }
    </style>
</head>
<body>

<div class="page-header">
    <div class="chart-type-badge">
        <span class="icon">ğŸ—ºï¸</span>
        <span class="text">åœ°ç†å›¾è¡¨</span>
    </div>
    <h1>åœ°å›¾å¯è§†åŒ– Map</h1>
    <p class="subtitle">åŸºäº AntV L7Plot æ„å»ºçš„ä¸“ä¸šåœ°ç†æ•°æ®åˆ†æç»„ä»¶</p>
</div>

<!-- äº¤äº’å¼ç¤ºä¾‹ -->
<div class="spec-section">
    <div class="spec-title">äº¤äº’å¼æ¼”ç¤ºï¼šä¸­å›½åŒºåŸŸåœ°å›¾</div>
    <div class="map-demo-container">
        <div class="map-header">
            <div>
                <h3 style="margin:0; font-size: 17px;">å…¨å›½å„çœä»½æ¨¡æ‹Ÿæ•°æ®åˆ†å¸ƒ</h3>
                <p style="margin:4px 0 0; font-size: 13px; color: #86868b;">å±•ç¤ºè¡Œæ”¿åŒºåˆ’ç€è‰²ä¸äº¤äº’</p>
            </div>
            <div id="map-status" style="font-size: 12px; color: #0071E3;">éœ€é…ç½® API Key</div>
        </div>
        <div class="map-canvas" id="map-container">
            <div class="api-key-mask" id="api-mask">
                <div style="font-size: 24px; margin-bottom: 12px;">ğŸ—ºï¸</div>
                <h4 style="margin:0;">åˆå§‹åŒ–åœ°ç†æœåŠ¡</h4>
                <p style="color: #86868b; margin: 8px 0;">ç”±äºåœ°å›¾åº•å›¾æœåŠ¡éœ€è¦ API Keyï¼Œè¯·è¾“å…¥æ‚¨çš„é«˜å¾·åœ°å›¾ Key é¢„è§ˆ</p>
                <input type="text" id="gaode-key" class="api-key-input" placeholder="è¯·è¾“å…¥é«˜å¾·åœ°å›¾ Key (amap key)" value="">
                <button class="btn-run" onclick="initMap()">å¯åŠ¨åœ°å›¾é¢„è§ˆ</button>
                <div style="margin-top: 16px; font-size: 12px; color: #86868b;">
                    <a href="https://lbs.amap.com/dev/key/app" target="_blank" style="color: #0071E3;">å¦‚ä½•è·å– Key?</a> | 
                    <button onclick="useDefault()" style="background:none; border:none; color:#0071E3; cursor:pointer; text-decoration:underline;">ä½¿ç”¨ MapLibre é»˜è®¤åº•å›¾(æ— éœ€Key)</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="spec-section">
    <div class="spec-title">åœ°å›¾æ ¸å¿ƒèƒ½åŠ›</div>
    <div class="map-types">
        <div class="map-type-card">
            <div class="icon">ğŸ—¾</div>
            <div class="name">åŒºåŸŸåœ°å›¾ (Choropleth)</div>
            <div class="desc">è¡Œæ”¿åŒºåˆ’å¡«è‰²ï¼Œå±•ç¤ºåˆ†åŒºåŸŸçš„ç»Ÿè®¡æŒ‡æ ‡</div>
        </div>
        <div class="map-type-card">
            <div class="icon">ğŸ“</div>
            <div class="name">æ°”æ³¡/æ•£ç‚¹ (DotMap)</div>
            <div class="desc">ç²¾å‡†åæ ‡ç‚¹ä½ï¼Œå±•ç¤ºä½ç½®åˆ†å¸ƒä¸å¼ºåº¦</div>
        </div>
        <div class="map-type-card">
            <div class="icon">ğŸ”¥</div>
            <div class="name">çƒ­åŠ›å›¾ (HeatMap)</div>
            <div class="desc">ç½‘æ ¼æˆ–èœ‚çªèšåˆï¼Œå±•ç¤ºé«˜å¯†åº¦æ•°æ®</div>
        </div>
    </div>
</div>

<div class="spec-section">
    <div class="spec-title">ä»£ç å®ç°å‚è€ƒ</div>
    <div class="code-block">
<pre><span class="keyword">import</span> { Choropleth } <span class="keyword">from</span> <span class="string">'@antv/l7plot'</span>;

<span class="comment">// 1. å‡†å¤‡ GeoJSON æ•°æ®</span>
<span class="keyword">const</span> response = <span class="keyword">await</span> fetch(<span class="string">'https://geo.datav.aliyun.com/areas_v3/bound/100000_full.json'</span>);
<span class="keyword">const</span> chinaGeo = <span class="keyword">await</span> response.json();

<span class="comment">// 2. åˆå§‹åŒ–åœ°å›¾</span>
<span class="keyword">new</span> Choropleth(<span class="string">'container'</span>, {
  map: {
    type: <span class="string">'mapbox'</span>, <span class="comment">// æˆ– 'amap'</span>
    style: <span class="string">'light'</span>,
    center: [<span class="number">105</span>, <span class="number">31.5</span>],
    zoom: <span class="number">3</span>,
  },
  source: {
    data: chinaGeo,
    joinBy: { sourceField: <span class="string">'adcode'</span>, geoField: <span class="string">'adcode'</span> },
  },
  viewLevel: { level: <span class="string">'country'</span>, adcode: <span class="number">100000</span> },
  color: {
    field: <span class="string">'value'</span>,
    value: [<span class="string">'#B8E1FF'</span>, <span class="string">'#0071E3'</span>],
  },
  label: { visible: <span class="keyword">true</span> },
  tooltip: { items: [<span class="string">'name'</span>, <span class="string">'value'</span>] },
});</pre>
    </div>
</div>

<div style="margin-top: 24px; padding: 20px; background: #F5F5F7; border-radius: 16px;">
    <div style="font-weight: 600; color: var(--apple-gray-900); margin-bottom: 8px;">ğŸ’¡ å¼€å‘æŒ‡å—</div>
    <ul style="font-size: 14px; color: #86868b; padding-left: 20px; line-height: 1.8;">
        <li><b>æ•°æ®æ¥æº</b>ï¼šæ¨èä½¿ç”¨é˜¿é‡Œäº‘ DataV.GeoAtlas è·å–æœ€æ–°çš„è¡Œæ”¿åŒºåˆ’æ•°æ®ã€‚</li>
        <li><b>åº•å›¾é€‰æ‹©</b>ï¼šå›½å†…ä¸šåŠ¡æ¨èä½¿ç”¨é«˜å¾· (AMap)ï¼Œå›½é™…ä¸šåŠ¡æ¨èä½¿ç”¨ Mapboxã€‚</li>
        <li><b>æ€§èƒ½ä¼˜åŒ–</b>ï¼šå¯¹äºå¤§è§„æ¨¡æ•£ç‚¹æ•°æ®ï¼ˆ10ä¸‡+ï¼‰ï¼Œè¯·ä½¿ç”¨ L7 åŸç”Ÿå›¾å±‚è€Œé L7Plot ç®€åŒ–ç‰ˆã€‚</li>
    </ul>
</div>

<script>
    let mapInstance = null;

    async function initMap(type = 'amap', key = '') {
        const gaodeKey = key || document.getElementById('gaode-key').value;
        
        if (type === 'amap' && !gaodeKey) {
            alert('è¯·å…ˆè¾“å…¥é«˜å¾·åœ°å›¾ API Key');
            return;
        }

        document.getElementById('api-mask').style.display = 'none';
        document.getElementById('map-status').innerText = 'æ­£åœ¨åŠ è½½åœ°ç†æ•°æ®...';

        try {
            // åŠ è½½æ¨¡æ‹Ÿæ•°æ®å’Œ GeoJSON
            const res = await fetch('https://gw.alipayobjects.com/os/alisis/geo-data-v2/china.json');
            const data = await res.json();
            
            // æ„é€ æ¨¡æ‹Ÿæ•°å€¼
            const plotData = data.features.map(f => ({
                name: f.properties.name,
                adcode: f.properties.adcode,
                value: Math.round(Math.random() * 1000)
            }));

            const config = {
                map: {
                    type: type,
                    style: 'light',
                    center: [105, 31.5],
                    zoom: 3,
                    token: type === 'amap' ? gaodeKey : undefined
                },
                source: {
                    data: data,
                    joinBy: {
                        sourceField: 'adcode',
                        geoField: 'adcode',
                    },
                },
                color: {
                    field: 'value',
                    value: ['#E8F3FF', '#5B8FF9', '#0071E3'],
                },
                label: {
                    visible: true,
                    field: 'name',
                    style: { fill: '#000', opacity: 0.6, fontSize: 10 }
                },
                tooltip: {
                    items: ['name', 'value']
                },
                state: {
                    active: { stroke: '#FFF', strokeWeight: 2 }
                }
            };

            if (mapInstance) mapInstance.destroy();
            mapInstance = new L7Plot.Choropleth('map-container', config);
            
            document.getElementById('map-status').innerText = 'åœ°å›¾åŠ è½½æˆåŠŸ âœ“';
        } catch (err) {
            console.error(err);
            document.getElementById('map-status').innerText = 'åŠ è½½å¤±è´¥: ' + err.message;
            document.getElementById('api-mask').style.display = 'flex';
        }
    }

    function useDefault() {
        initMap('maplibre'); // MapLibre usually doesn't need a token for basic styles in some contexts, 
                             // but L7Plot might still want one. Using 'mapbox' with a public token is another option.
    }
</script>

<script src="../nav.js"></script>
</body>
</html>
