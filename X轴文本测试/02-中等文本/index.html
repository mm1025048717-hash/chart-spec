<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中等文字45度倾斜 - X轴文字优化方案</title>
    <script src="https://cdn.jsdelivr.net/npm/@antv/g2plot@2.4.31/dist/g2plot.min.js"></script>
    <link rel="stylesheet" href="../../common.css">
    <style>
        .scenario-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #E6F7F0 0%, #C8F0E0 100%);
            padding: 8px 16px;
            border-radius: 20px;
            margin-bottom: 24px;
        }
        .scenario-badge .icon {
            width: 24px;
            height: 24px;
            background: var(--green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .scenario-badge .text {
            font-size: 14px;
            color: #00A854;
            font-weight: 500;
        }

        .key-point {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #E6F7F0;
            color: #00A854;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            margin: 4px;
        }
        .key-point::before {
            content: '✓';
            font-weight: bold;
        }

        .angle-demo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 40px;
            padding: 30px;
            background: #FAFBFC;
            border-radius: 8px;
            margin: 20px 0;
        }
        .angle-box {
            text-align: center;
        }
        .angle-visual {
            width: 100px;
            height: 60px;
            position: relative;
            margin: 0 auto 10px;
        }
        .angle-line {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 80px;
            height: 2px;
            background: var(--green);
            transform-origin: left center;
        }
        .angle-line.rotated {
            transform: rotate(-45deg);
        }
        .angle-text {
            position: absolute;
            bottom: 10px;
            left: 60%;
            font-size: 11px;
            color: var(--text);
            transform: rotate(-45deg);
            white-space: nowrap;
        }
        .angle-label {
            font-size: 12px;
            color: var(--text-sub);
        }
        .angle-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--green);
            font-family: 'SF Mono', monospace;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            .comparison-grid { grid-template-columns: 1fr; }
        }
        .comparison-item {
            background: #FAFBFC;
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--border);
        }
        .comparison-item h4 {
            font-size: 13px;
            color: var(--text-sub);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .comparison-item h4 .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .comparison-item.good h4 .dot { background: var(--green); }
        .comparison-item.bad h4 .dot { background: var(--red); }

        .data-preview {
            background: #1F2329;
            border-radius: 6px;
            padding: 12px;
            font-family: 'SF Mono', monospace;
            font-size: 11px;
            color: #E6E8EB;
            overflow-x: auto;
        }

        .math-formula {
            background: #F7F8FA;
            padding: 16px 20px;
            border-radius: 8px;
            font-family: 'SF Mono', monospace;
            font-size: 14px;
            text-align: center;
            margin: 16px 0;
            border: 1px solid var(--border);
        }
        .math-formula .var {
            color: var(--blue);
        }
        .math-formula .op {
            color: var(--text-sub);
            margin: 0 8px;
        }
        .math-formula .result {
            color: var(--green);
            font-weight: 600;
        }
    </style>
</head>
<body>

<div class="page-header">
    <div class="scenario-badge">
        <span class="icon">2</span>
        <span class="text">场景二：中等文字倾斜显示</span>
    </div>
    <h1>中等文字 (5-8视觉宽度) - 45°倾斜</h1>
    <p class="subtitle">适用于中等长度标签如：华东地区、2024年Q1、产品类型A 等</p>
    <div class="tech-stack">
        <span class="tech-tag">Ant Design Chart</span>
        <span class="tech-tag">G2Plot</span>
        <span class="tech-tag">rotate: -45°</span>
    </div>
</div>

<!-- 角度演示 -->
<div class="spec-section">
    <div class="spec-title">45度倾斜效果</div>
    
    <div class="angle-demo">
        <div class="angle-box">
            <div class="angle-visual">
                <div class="angle-line"></div>
            </div>
            <div class="angle-label">水平 (0°)</div>
            <div class="angle-value">rotate: 0</div>
        </div>
        <div style="font-size: 24px; color: var(--text-sub);">→</div>
        <div class="angle-box">
            <div class="angle-visual">
                <div class="angle-line rotated"></div>
                <div class="angle-text">华东地区</div>
            </div>
            <div class="angle-label">倾斜 (-45°)</div>
            <div class="angle-value">-Math.PI/4</div>
        </div>
    </div>

    <div class="math-formula">
        <span class="var">-45°</span>
        <span class="op">=</span>
        <span class="var">-π/4</span>
        <span class="op">≈</span>
        <span class="result">-0.7854 弧度</span>
    </div>
</div>

<!-- 设计规范说明 -->
<div class="spec-section">
    <div class="spec-title">适用场景与判断条件</div>
    
    <div class="comparison-grid">
        <div class="comparison-item good">
            <h4><span class="dot"></span>适用数据示例</h4>
            <div class="data-preview">
[
  { region: '华东地区', value: 3650 },  <span style="color:#6A737D;">// 4中文 = 8视觉宽度</span>
  { region: '华北地区', value: 2808 },
  { region: '2024Q1', value: 2408 },   <span style="color:#6A737D;">// 6英数 = 6视觉宽度</span>
  { region: 'January', value: 2236 },  <span style="color:#6A737D;">// 7英文 = 7视觉宽度</span>
]
            </div>
        </div>
        <div class="comparison-item bad">
            <h4><span class="dot"></span>不适用数据示例</h4>
            <div class="data-preview">
[
  { region: '华东', value: 3650 },   <span style="color:#6A737D;">// 2中文 = 4视觉宽度 → 用水平</span>
  { region: 'MacBook Pro 16英寸', value: 2808 }, <span style="color:#6A737D;">// 太长 → 需截断</span>
]
            </div>
        </div>
    </div>

    <div class="spec-title">触发条件</div>
    <table class="spec-table">
        <thead>
            <tr>
                <th style="width: 180px;">条件</th>
                <th style="width: 150px;">阈值</th>
                <th>说明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><b>最大视觉宽度</b></td>
                <td><code>5 - 8</code></td>
                <td>超过4但不超过8的视觉宽度</td>
            </tr>
            <tr>
                <td><b>数据项数量</b></td>
                <td><code>≤ 12</code></td>
                <td>12项以内可以完整显示不截断</td>
            </tr>
            <tr class="highlight">
                <td><b>同时满足</b></td>
                <td><code>AND</code></td>
                <td>两个条件必须同时满足</td>
            </tr>
        </tbody>
    </table>

    <div style="margin-top: 16px;">
        <span class="key-point">45度倾斜显示</span>
        <span class="key-point">无截断，完整显示</span>
        <span class="key-point">右对齐 (textAlign: end)</span>
        <span class="key-point">节省横向空间</span>
    </div>
</div>

<!-- 核心配置代码 -->
<div class="spec-section">
    <div class="spec-title">核心配置代码</div>
    <div class="code-block">
<span class="comment">// 中等文字场景配置</span>
<span class="keyword">const</span> xAxisConfig = {
    label: {
        autoRotate: <span class="keyword">false</span>,           <span class="comment">// 禁用自动旋转</span>
        rotate: -Math.PI / <span class="number">4</span>,         <span class="comment">// -45度 (弧度制)</span>
        formatter: (text) => text,       <span class="comment">// 不截断，原样返回</span>
        style: {
            fontSize: <span class="number">11</span>,
            fill: <span class="string">'#646A73'</span>,
            textAlign: <span class="string">'end'</span>,           <span class="comment">// 旋转时右对齐</span>
        },
    },
};

<span class="comment">// 判断函数</span>
<span class="keyword">function</span> <span class="function">shouldUse45Degree</span>(data, xField) {
    <span class="keyword">const</span> maxWidth = Math.max(...data.map(d => getVisualWidth(String(d[xField]))));
    <span class="keyword">const</span> count = data.length;
    <span class="comment">// 超过短文字条件，但在中等范围内</span>
    <span class="keyword">return</span> (maxWidth > <span class="number">4</span> || count > <span class="number">8</span>) && maxWidth <= <span class="number">8</span> && count <= <span class="number">12</span>;
}
    </div>
</div>

<!-- 图表展示 -->
<div class="chart-container">
    <div class="chart-card">
        <div class="chart-card-header">
            <span class="chart-title">各大区销售额对比（中等文字标签）</span>
            <span class="chart-tag green">rotate: -45°</span>
        </div>
        <div class="chart-body md">
            <div class="axis-unit y-left">万元</div>
            <div id="chart-main" style="width: 100%; height: 100%;"></div>
        </div>
        <div class="chart-summary">
            数据项：<strong>6项</strong> | 最大视觉宽度：<strong>8</strong> | 判定结果：<strong>45°倾斜 ✓</strong>
        </div>
    </div>
</div>

<!-- 配置参数详解 -->
<div class="spec-section">
    <div class="spec-title">完整配置参数</div>
    <table class="spec-table">
        <thead>
            <tr>
                <th style="width: 160px;">参数</th>
                <th style="width: 140px;">值</th>
                <th style="width: 150px;">类型</th>
                <th>说明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>xAxis.label.rotate</code></td>
                <td><code>-Math.PI/4</code></td>
                <td>number (弧度)</td>
                <td>-45度，逆时针旋转</td>
            </tr>
            <tr>
                <td><code>xAxis.label.autoRotate</code></td>
                <td><code>false</code></td>
                <td>boolean</td>
                <td>禁用自动旋转</td>
            </tr>
            <tr class="highlight">
                <td><code>xAxis.label.style.textAlign</code></td>
                <td><code>'end'</code></td>
                <td>string</td>
                <td><b>重要</b>：旋转时必须用end对齐</td>
            </tr>
            <tr>
                <td><code>xAxis.label.style.fontSize</code></td>
                <td><code>11</code></td>
                <td>number (px)</td>
                <td>轴标签字体大小</td>
            </tr>
            <tr>
                <td><code>xAxis.label.style.fill</code></td>
                <td><code>'#646A73'</code></td>
                <td>string (color)</td>
                <td>轴标签文字颜色</td>
            </tr>
        </tbody>
    </table>
</div>

<!-- textAlign 重要说明 -->
<div class="spec-section">
    <div class="spec-title">textAlign 对齐方式说明</div>
    
    <table class="spec-table">
        <thead>
            <tr>
                <th style="width: 120px;">旋转角度</th>
                <th style="width: 120px;">textAlign</th>
                <th>原因</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>0° (水平)</td>
                <td><code>center</code></td>
                <td>水平文字居中于刻度线</td>
            </tr>
            <tr class="highlight">
                <td>-45° (倾斜)</td>
                <td><code>end</code></td>
                <td>倾斜文字的末端对准刻度线，视觉更整齐</td>
            </tr>
            <tr>
                <td>-90° (垂直)</td>
                <td><code>end</code></td>
                <td>垂直文字的末端对准刻度线</td>
            </tr>
        </tbody>
    </table>

    <div style="margin-top: 16px; padding: 12px; background: #FFF7E6; border-radius: 6px; font-size: 13px; color: #D48806;">
        ⚠️ <b>常见错误</b>：旋转时使用 textAlign: 'center' 会导致标签偏移，无法对准柱体中心。
    </div>
</div>

<!-- 边界情况 -->
<div class="spec-section">
    <div class="spec-title">边界情况处理</div>
    <table class="spec-table">
        <thead>
            <tr>
                <th style="width: 200px;">情况</th>
                <th style="width: 150px;">处理方式</th>
                <th>说明</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>视觉宽度 = 5</td>
                <td>使用45°倾斜</td>
                <td>刚好进入中等范围</td>
            </tr>
            <tr>
                <td>视觉宽度 = 8</td>
                <td>使用45°倾斜</td>
                <td>8是中等范围的上界</td>
            </tr>
            <tr>
                <td>数据项 = 12</td>
                <td>使用45°倾斜</td>
                <td>12项是临界值，包含在内</td>
            </tr>
            <tr class="highlight">
                <td>视觉宽度 > 8</td>
                <td><b>需要截断</b></td>
                <td>切换到场景3：45°+截断</td>
            </tr>
            <tr class="highlight">
                <td>数据项 > 12</td>
                <td><b>考虑90°</b></td>
                <td>可能需要切换到场景6</td>
            </tr>
        </tbody>
    </table>
</div>

<script>
const { Column } = G2Plot;

// 视觉宽度计算函数
function getVisualWidth(str) {
    let width = 0;
    for (let i = 0; i < str.length; i++) {
        const charCode = str.charCodeAt(i);
        if (charCode >= 0x4E00 && charCode <= 0x9FFF ||
            charCode >= 0x3000 && charCode <= 0x303F ||
            charCode >= 0xFF00 && charCode <= 0xFFEF) {
            width += 2;
        } else {
            width += 1;
        }
    }
    return width;
}

// 中等文字数据
const data = [
    { region: '华东地区', value: 3650 },
    { region: '华北地区', value: 2808 },
    { region: '华南地区', value: 2408 },
    { region: '华中地区', value: 2236 },
    { region: '西北地区', value: 1500 },
    { region: '西南地区', value: 1648 },
];

// 计算并输出判断信息
const maxWidth = Math.max(...data.map(d => getVisualWidth(d.region)));
console.log('最大视觉宽度:', maxWidth, '数据项数:', data.length);
console.log('判定:', maxWidth <= 8 && data.length <= 12 ? '45°倾斜' : '需要其他处理');

new Column('chart-main', {
    data,
    xField: 'region',
    yField: 'value',
    color: '#5AD8A6',
    columnWidthRatio: 0.5,
    columnStyle: {
        radius: [4, 4, 0, 0],
    },
    // 核心：中等文字X轴配置
    xAxis: {
        label: {
            autoRotate: false,
            rotate: -Math.PI / 4,  // -45度
            style: {
                fontSize: 11,
                fill: '#646A73',
                textAlign: 'end',  // 重要：旋转时用end对齐
            },
        },
    },
    yAxis: {
        label: {
            formatter: (v) => v.toLocaleString(),
        },
    },
    label: {
        position: 'top',
        style: {
            fill: '#5AD8A6',
            fontSize: 11,
        },
        formatter: (datum) => datum.value.toLocaleString(),
    },
    tooltip: {
        formatter: (datum) => ({
            name: datum.region,
            value: datum.value.toLocaleString() + ' 万元',
        }),
    },
}).render();
</script>


<script src="../../nav.js"></script>
</body>
</html>
